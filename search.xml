<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>北工大野生助手</title>
      <link href="posts/cknp0yiaj000o0zo674d3d6xx/"/>
      <url>posts/cknp0yiaj000o0zo674d3d6xx/</url>
      
        <content type="html"><![CDATA[<p>北工大查分野生助手。是<a href="http://www.wangyufeng.org/">王雨峰童鞋</a>带头写的一个工大查分小助手。后来申请了星火基金，现在由我和雨峰共同维护。具体说明还在写，先写更新日志。<br>项目地址：<a href="https://github.com/wangyufeng0615/bjuthelper">https://github.com/wangyufeng0615/bjuthelper</a><br>主页：<a href="http://chafen.bjut123.com/">http://chafen.bjut123.com</a><br>内测版：<a href="http://bjut.devchen.cn/">http://bjut.devchen.cn</a>  </p><span id="more"></span><p>##更新日志<br>###2017.1.12</p><ul><li>添加了更新日志。  </li><li>微调了总科目数的提示文字，避免歧义。  </li><li>修正了未通过科目数计算错误。</li><li>修正了中文成绩（等级）导致的科目计算错误。</li><li>增加了可折叠的通过/未通过成绩统计。</li></ul><p>###2017.1.11</p><ul><li>修正了由新生研讨课的中文课程成绩和数据格式不统一导致的计算 bug。（可能会导致部分人加权分数变化）</li><li>修正了错误的绩点计算方式，已经更正为平均学分绩点（加权），参考 <a href="http://undergrad.bjut.edu.cn/WebInfo.aspx?Id=752">教务处文件</a>。</li><li>更改了页面编码为 UTF-8。（但教务那边的辣鸡还是 GB2312 我们也没什么办法）</li></ul><p>###2017.1.3</p><ul><li>移除了文件式 cookie，加快了响应和服务器负载。</li><li>添加了免验证码。</li></ul><p>###2016.12.6</p><ul><li>添加了说明信息和 ICP 备案号</li></ul><p>###2016.12.3</p><ul><li>修正了部分验证码错位的问题</li></ul><p>###2016.11.28</p><ul><li>微调了代码架构，加强了微信浏览器的兼容性。</li></ul><p>###2016.7.23</p><ul><li>增加了代码说明和项目说明，配了图。</li></ul><p>###2016.7.16</p><ul><li>首次上传</li></ul><p>##二维码<br>来，扫码吧！<br>王雨峰的公众号：七系<br><img src="/blogimg/20170112-bjut-helper/1.png"><br>十七的空指针：<br><img src="/blogimg/20170112-bjut-helper/2.png"></p><p align="right">by Sykie Chen & Alan Wang2017.1.12</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 北京工业大学 </tag>
            
            <tag> 北工大 </tag>
            
            <tag> 查分 </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Resilio 私有云的文件同步方案</title>
      <link href="posts/cknp0yiah000l0zo69gdk82qs/"/>
      <url>posts/cknp0yiah000l0zo69gdk82qs/</url>
      
        <content type="html"><![CDATA[<p>国内的云服务该倒的都倒了，剩的也都是一些残废。加上最近买了一个小笔记本随身带着，多设备间工作文件的实时同步变得非常重要。<br>尝试了 Dropbox 、 Google Drive 、 付费坚果云等多种云服务之后，我最终选择了 Resilio （原 BTSync ）来搭私有云。</p><span id="more"></span><p>##1. 最初的尝试<br>Resilio 是基于 P2P 的文件同步服务，它把文件分散存储在参与同步的节点上，在同一子网下甚至可以通过 LAN 高速同步。类似 BT 下载的 DHT 网络保证即使客户机没有公网地址也能打洞。<br>起初我只在我的主电脑（几乎不关机）和随身的小电脑上部署了 Resilio ，但主电脑使用的山寨百兆宽带十分不稳定，小电脑在同样不稳定的网络下（对我说的就是你， BJUT 校园网）几乎无法连接主电脑上的节点，即使侥幸连上，速度也只有幽默的十几K。没办法，只能放弃。</p><p>##2. 为什么放弃坚果云<br>然后我开始尝试各种商用云服务。国外的各类云服务虽然成熟，但速度全都非常感人。最后在各方安利之下换了坚果云。但坚果云的收费方案非常有意思，按流量收费。免费用户每月最多上传 1G，下载 3G。我数了数我需要保持同步的文件，大概有 8G 左右，精简过后也有 2.5G ，也就是说初始的同步要两个月之后才能完成。<br>那好吧。<br><img src="/blogimg/20161217-resilio/2016-12-17-14-05-16.jpg"><br>付了费之后，空间方案是 30G 初始，每月 +1G， 不限流量。 我开开心心地把 2.5G 传上去了。传完之后我看到了这个：<br><img src="/blogimg/20161217-resilio/2016-12-17-14-10-33.jpg"><br><a href="http://help.jianguoyun.com/?p=1582">http://help.jianguoyun.com/?p=1582</a><br>还有这个：<br><img src="/blogimg/20161217-resilio/2016-12-17-14-11-43.jpg"><br><a href="http://help.jianguoyun.com/?p=1366">http://help.jianguoyun.com/?p=1366</a><br>我擦，我真是九脸蒙蔽。下个月我断供就不能用了？想用至少续费三个月？而且假如我过了几个月又有大量数据要传，还得先补上上次付费和这次付费之间断供的时间？<br><img src="/blogimg/20161217-resilio/2016-12-17-14-18-48.jpg"><br>一个月 30，还是有点贵的，数据还被掐在人家手里，不值得。<br>你可以说我付不起钱穷之类的，我只是觉得不值得。有30块我干嘛不给我的 VPS 升一下级？</p><p>##3. 重新部署 Resilio<br>坚果云还剩27天，但我已经不想用了。我又重新研究了一下 Resilio ，觉得我可以在我的 VPS 上部署一个 Resilio 作为同步节点。在外网时，小电脑可以通过稳定的 VPS 保持同步。和大电脑在同一内网下时，又可以通过 LAN 快速完成。我的 VPS 是 ConoHa 东京节点，国内访问除了电信有时候丢包厉害点，速度还 OK。<br>Resilio 支持加密分享，也就是说部署在 VPS 上节点的文件可以是加密过的，在 VPS 端无法读取。<br>而且如果有条件，可以部署多个 VPS 节点，比如在阿里云或者腾讯云上部署一个，加快国内访问速度。节点之间可以保持同步。<br>我的服务器系统是 Cent OS，安装 Resilio 只需要导入 yum 源，再导入公钥即可。参考<a href="https://help.getsync.com/hc/en-us/articles/206178924">官方文档</a>。<br>新建<code>/etc/yum.repos.d/resilio-sync.repo</code><br>内容为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[resilio-sync]</span><br><span class="line">name=Resilio Sync <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://linux-packages.resilio.com/resilio-sync/rpm/<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br></pre></td></tr></table></figure><p>然后添加公钥：<br><code>rpm --import https://linux-packages.resilio.com/resilio-sync/key.asc</code><br>再用 yum 安装：<br><code>yum install resilio-sync</code></p><p>安好后准备一下同步目录和配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/sync</span><br><span class="line">chmod -R 755 /home/sync</span><br><span class="line">cd /home/sync</span><br><span class="line">rslsync --dump-sample-config &gt; rslsync.conf</span><br></pre></td></tr></table></figure><p>编辑配置文件，编辑一下你的机器名、端口号、用户名密码之类的。文件里的说明很详细。我就不多说了。<br><img src="/blogimg/20161217-resilio/2016-12-17-14-51-10.jpg"><br>然后载入配置文件<br><code>rslsync --config /home/sync/rslsync.conf</code><br>并把这条命令加到 rc.local 开机启动，保证每次都能加载这个配置。<br>配置一下防火墙之后，就可以通过 ip:9999 来访问了。<br>登进去之后就跟本地客户端一样啦。在本机的 Resilio 添加同步文件夹，类型选择加密。<br><img src="/blogimg/20161217-resilio/2016-12-17-14-57-41.jpg"><br>会出现三种密钥。<br><img src="/blogimg/20161217-resilio/2016-12-17-15-00-01.jpg"><br>在 VPS 的 resilio 中添加第三个加密密钥，在小电脑的 resilio 中添加读写密钥。<br>这样，大小电脑上的修改都会同步到对方以及 VPS，但 VPS 端文件的变化不会同步到本地机器，保证数据安全。两台电脑上文件同步时，VPS 可以作为加速节点。而且 VPS 端的文件全部是加密过的，如图。<br><img src="/blogimg/20161217-resilio/2016-12-17-15-02-16.jpg"><br>这样即使放到国内的主机上也可以放心数据安全。<br><img src="/blogimg/20161217-resilio/2016-12-17-15-03-34.jpg"><br>在节点列表中可以看到另一台电脑和服务器。<br>如果购买 Pro 授权，还可以选择性同步。未同步的文件会显示为 0KB 占位符，当双击调用或者手动同步时才主动下载。Resilio 的同步是差分增量的，文件会被分割，只同步变化的区块。<br>购买了 Pro 授权之后可以把两台电脑关联为同一账户，添加的文件夹会自动同步到两台机器上，不用在小电脑上手动添加读写密钥。但注意不要在云端使用同一账户，否则不会加密。<br>这个 Pro 授权国内99块人民币，终身授权。比坚果云不知高到哪里去了。<br>氪！<br><img src="/blogimg/20161217-resilio/2016-12-17-15-20-47.jpg"></p><p>参考了：<br><a href="http://maokwen.tk/2016/10/14/build-a-private-cloud-on-vps.html">http://maokwen.tk/2016/10/14/build-a-private-cloud-on-vps.html</a><br><a href="https://www.freehao123.com/pcloud/">https://www.freehao123.com/pcloud/</a><br><a href="http://www.dongcoder.com/detail-176844.html">http://www.dongcoder.com/detail-176844.html</a></p><p align="right">by Sykie Chen2016.12.17</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Resilio </tag>
            
            <tag> 私有云 </tag>
            
            <tag> 同步 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个微博小游戏的 hack 历程</title>
      <link href="posts/cknp0yiag000k0zo630rlbprw/"/>
      <url>posts/cknp0yiag000k0zo630rlbprw/</url>
      
        <content type="html"><![CDATA[<p>今天在微博上看到一个找狗的<a href="http://m.weibo.cn/client/game?sinainternalbrowser=topnav">小游戏</a>：  </p><p>简单地说就是在一堆表情里找出 doge 的表情，限时一分钟。<br>作为一个程序猿，我第一反应就是要去搞掉这个榜单。  </p><span id="more"></span><p><img src="/blogimg/20160416-weibo-doge/1.png"></p><p>首先想到用按键精灵的自动搜图去自动点击，于是迅速写了个简单的脚本：  </p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FindPic <span class="number">0</span>,<span class="number">0</span>,<span class="number">1600</span>,<span class="number">1000</span>,<span class="string">&quot;Attachment:\doge.bmp&quot;</span>,<span class="number">0.5</span>,intX,intY</span><br><span class="line"><span class="keyword">If</span> intX &gt; <span class="number">0</span> <span class="keyword">And</span> intY &gt; <span class="number">0</span> <span class="keyword">Then</span> </span><br><span class="line">    MoveTo intX + <span class="number">15</span>, intY + <span class="number">15</span></span><br><span class="line">    LeftClick <span class="number">1</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br></pre></td></tr></table></figure><p><img src="/blogimg/20160416-weibo-doge/2.png">  </p><p>执行之后刷出了161分：<br><img src="/blogimg/20160416-weibo-doge/3.png"><br>由于按键精灵的解析速度有限，161分基本是一分钟内能刷出的上限了，难以搞一个更大的新闻出来。于是就想到了直接修改代码。<br>这里有两条路可走，一是修改游戏代码本身，以类似于游戏修改器的思路改成绩，或者干脆延长总时间。再一个就是伪造游戏结束时向服务器发的比分数据，直接改成绩。<br>根据经验判断后者应该更方便，于是开 Fiddler 抓包：<br><img src="/blogimg/20160416-weibo-doge/4.png"><br>发现在时间剩余十秒时会向服务器请求当前前20名的用户列表，是一个 json，地址是 <a href="http://m.weibo.cn/client/game/getTopUser">http://m.weibo.cn/client/game/getTopUser</a> ：<br><img src="/blogimg/20160416-weibo-doge/5.png"><br>图里的前两名都是我刷出来的，不要在意。<br>注意当一局游戏结束的时候，如果不点击分享到微博，分数是不会上传到服务器的，榜单里也不会更新你。单击分享后会自动生成一条微博，并随机艾特三个人。微博为了推广真是够恶心的。<br><img src="/blogimg/20160416-weibo-doge/6.png"><br>抓分享的包，发现请求中有两个值，score 和 st：<br><img src="/blogimg/20160416-weibo-doge/7.png"><br>score 无疑是本场分数了，st 根据我的多次抓包判断，是标记当前用户 id 的值。所以我们修改的重点在 score 上。<br>这个 score 加密过，看长度不是 md5，尝试了常见的加密方式均不能解密。重复试验几次也没有发现规律：<br><img src="/blogimg/20160416-weibo-doge/8.png"><br>陷入僵局，决定先分析页面源码。<br><img src="/blogimg/20160416-weibo-doge/10.png"><br>在页面中的 JavaScript 发现了大新闻，加密函数是写在里面的：<br><img src="/blogimg/20160416-weibo-doge/9.png"><br>这就好办了，直接把整个 a 这个类抠出来，新建个 js 放进去在本地执行就好。可以算出想要的任意值。<br>先算个 65535 练练手。65535 的密文是 d0510f276a65373d。在 Fiddler 里直接修改刚才那个请求，发送后返回成功：<br><img src="/blogimg/20160416-weibo-doge/11.png"><br>此时自动发了一条新的微博，说我得了65535分。<br>那试一下自己的手机号吧，貌似不会溢出。也成功了，图在上面就有。<br>唔，那再搞个大新闻，试试 10^101 ?<br><img src="/blogimg/20160416-weibo-doge/12.png"><br>好好好，榜单首位妥妥的是我的了，我已经吊到溢出边框了：<br><img src="/blogimg/20160416-weibo-doge/13.png"><br>这个时候注意到一个问题，那条微博当时就刷出来了，但榜单隔了差不多两三分钟才刷出来我那个超大的值，怀疑服务器那边卡住了。那就作个死，看看能不能搞死服务器？我们知道 JS 里有个 Infinity 的值表示无穷大，这里把无穷大带进去算，得到 b30f73e94186ee62。发送请求提示成功，但刷不出微博，刷新榜单也出不来，看来是被过滤掉了。<br>好了本次作死成功完成~<br>特别感谢<a href="http://jobslong.com/">小文老板</a>用 node.js 环境跑出了加密部分的 js~  </p><p>榜单地址： <a href="http://m.weibo.cn/client/game/getTopUser">http://m.weibo.cn/client/game/getTopUser</a><br>游戏地址： <a href="http://m.weibo.cn/client/game?sinainternalbrowser=topnav">http://m.weibo.cn/client/game?sinainternalbrowser=topnav</a>  </p><p><img src="/blogimg/20160416-weibo-doge/14.png"><br>摸摸大  </p><hr><p align="right">by Sykie Chen2016.4.16</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
            <tag> JavaScript </tag>
            
            <tag> 微博 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EasyX 框架实现透明图片显示的 trick</title>
      <link href="posts/cknp0yiab000h0zo62kkd3rsd/"/>
      <url>posts/cknp0yiab000h0zo62kkd3rsd/</url>
      
        <content type="html"><![CDATA[<p>很多学校教授 C++ 图形编程时，为了规避 Windows 下 VC++ 较为复杂的绘图 API，都会（强制）要求学生使用 <a href="http://easyx.cn/">EasyX</a> 这一绘图框架。该框架十分简陋地实现了初学者所需的图形功能。同时，此框架也存在大量不足，最为不便的就是不支持 png 格式图片，不支持透明背景绘图。  </p><span id="more"></span><p>鉴于此框架的 putimage 函数支持三元光栅操作码，我们可以利用掩码位图来变相实现透明背景绘图。<br>参考了 <a href="http://code.qtuba.com/article-15636.html">http://code.qtuba.com/article-15636.html</a><br>##1. 创建一个掩码位图<br>掩码位图是一个单色位图，它的黑色部分就是位图显示时要保留的部分，白色部分就是要透明的部分。这里使用马里奥举例：<br>原图：<br><img src="/blogimg/20160217-easyx-trans-trick/1.png"><br>掩码图：<br><img src="/blogimg/20160217-easyx-trans-trick/2.png">  </p><p>##2.把掩码位图用SRCINVERT（XOR）方式叠加到原图<br>白色XOR白色=黑色（白色的RGB都是255，1^1=0），黑色XOR任何颜色=原颜色（0^0=0，0^1=1）。操作完成后原图的透明区应被黑色填充。<br>也可以直接用黑色填充原图。  </p><p>##3.把掩码位图用SRCAND（AND）方式叠加背景中<br>白色and任何颜色=原颜色(1&amp;1=1,1&amp;0=0)，黑色and任何颜色=黑色（0&amp;0=0，0&amp;1=0）。<br><img src="/blogimg/20160217-easyx-trans-trick/3.png">  </p><p>##4.把叠加过的原图用SRCPAINT(or)方式叠加到背景中<br>黑色or任何颜色=原颜色(0|1=1,0|0=0)。<br><img src="/blogimg/20160217-easyx-trans-trick/4.png">  </p><hr><p>代码如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;graphics.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">initgraph</span>(<span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line">    <span class="comment">// Load background</span></span><br><span class="line">    <span class="built_in">loadimage</span>(<span class="literal">NULL</span>, _T(<span class="string">&quot;img\\background.jpg&quot;</span>));</span><br><span class="line">    <span class="comment">// Load mario</span></span><br><span class="line">    IMAGE mariox, mario;</span><br><span class="line">    <span class="built_in">loadimage</span>(&amp;mariox, _T(<span class="string">&quot;img\\mariox.bmp&quot;</span>));</span><br><span class="line">    <span class="built_in">loadimage</span>(&amp;mario, _T(<span class="string">&quot;img\\mario.bmp&quot;</span>));</span><br><span class="line">    <span class="comment">// Trick to display transparent image</span></span><br><span class="line">    <span class="built_in">SetWorkingImage</span>(&amp;mario);</span><br><span class="line">    <span class="built_in">putimage</span>(<span class="number">0</span>, <span class="number">0</span>, &amp;mariox, SRCINVERT);</span><br><span class="line">    <span class="built_in">SetWorkingImage</span>(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">putimage</span>(<span class="number">400</span>, <span class="number">465</span>, &amp;mariox, SRCAND);</span><br><span class="line">    <span class="built_in">putimage</span>(<span class="number">400</span>, <span class="number">465</span>, &amp;mario, SRCPAINT);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="built_in">closegraph</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p align="right">by Sykie Chen2016.2.17</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> EasyX </tag>
            
            <tag> trick </tag>
            
            <tag> 图片 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多说 JS CSS 的本地化与站长回复和 UA 信息的添加</title>
      <link href="posts/cknp0yiaa000g0zo6gsdg3e9x/"/>
      <url>posts/cknp0yiaa000g0zo6gsdg3e9x/</url>
      
        <content type="html"><![CDATA[<p>多说评论系统被很多中文网站使用。网上有很多添加站长回复标记和浏览器操作系统信息的方法。但大部分均已随着多说 JS 的更新而不再有效或存在兼容性问题。我参考了这些教程并重写了相关代码以改进显示效果。  </p><span id="more"></span><p>先上图：<br><img src="/blogimg/20160212-duoshuo-ua/1.png"><br>可以解析 IE/Egde, Chrome, Safari, Firefox, Opera 等浏览器以及常见的几种国内壳浏览器。微博微信内置浏览器也可解析。<br>系统方面除了做了 iPhone/iPad 区分外，还加入了对1%的WP支持=。=<br>已有的教程多修改为带圆角矩形背景的文字， <del>难看的一笔</del> 不是十分的优雅。因此我改为了无背景，彩色加粗文字。<br>以及在无法识别的时候会显示 <del>奇怪♂的浏览器</del> 和 <del>奇怪♂的操作系统</del> 字样 <del>增加情趣</del> 提示用户。  </p><p>##1. 多说 JS 和 CSS 的本地化<br>多说引用的 JS 脚本地址为 <code>http://static.duoshuo.com/embed.js</code>，搞下来，改个名字或者不改也行。我这里改为 <code>ds_embed.js</code> 并放置到主题目录 <code>/source/js/</code> 中。<br>多说的 CSS 分为两部分，其一为通用部分，即多说后台设置的“主题”所包含的。这部分无需本地化。其二为多说后台“自定义CSS”的部分。这部分严格来说也无需本地化，但自己写的代码还是存成自己的文件比较稳妥，也便于本地维护，放在后台谁知道它哪天抽了就没了。<br>将多说后台“自定义CSS”中已有的内容剪切，写入到主题目录 <code>/source/css/duoshuo.css</code> 中。<br>然后修改<code>多说公共JS代码</code>，即我在 <a href="http://www.devchen.com/blog/coding/HTML/hexo-theme/">Hexo Landscape 主题修改优化</a> 一文中插入到 <code>layout\_partial\after-footer.ejs</code> 文件中的部分代码。<br>原来的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ds.src = (<span class="built_in">document</span>.location.protocol == <span class="string">&#x27;https:&#x27;</span> ? <span class="string">&#x27;https:&#x27;</span> : <span class="string">&#x27;http:&#x27;</span>) + <span class="string">&#x27;//static.duoshuo.com/embed.js&#x27;</span>;</span><br></pre></td></tr></table></figure><p>修改为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ds.src = <span class="string">&#x27;/js/ds_embed.js&#x27;</span>;</span><br></pre></td></tr></table></figure><p>然后在 <code>layout\_partial\head.ejs</code> 中合适的位置插入 css 引用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;/css/duoshuo.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>更新网站，若评论框正常显示则本地化成功。  </p><p>##2. 添加 CSS 样式<br>在 <code>duoshuo.css</code> 中插入以下代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* duoshuo UA marks */</span></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.ua</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">3px</span><span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_other</span>, <span class="selector-class">.os_other</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:<span class="number">#000</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_ie</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#428bca</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_firefox</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#f0ad4e</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_maxthon</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#7373B9</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_ucweb</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#FF740F</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_sogou</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#78ACE9</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_mi</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#FF4A00</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_chrome</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#EE6252</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_qq</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#3D88A8</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_apple</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#E95620</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ua_opera</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#d9534f</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.os_vista</span>,<span class="selector-class">.os_2000</span>,<span class="selector-class">.os_windows</span>,<span class="selector-class">.os_xp</span>,<span class="selector-class">.os_7</span>,<span class="selector-class">.os_8</span>,<span class="selector-class">.os_8_1</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#39b3d7</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.os_android</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#98C13D</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.os_ubuntu</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#DD4814</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.os_linux</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#3A3A3A</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.os_mac</span>, <span class="selector-class">.os_ios</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#666666</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.os_unix</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#006600</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.os_nokia</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#014485</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* admin reply mark */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#ds-reset</span> <span class="selector-tag">div</span> <span class="selector-tag">a</span><span class="selector-class">.sskadmin</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#3B74AC</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="number">#3B74AC</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">5px</span><span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">color</span>:<span class="number">#fff</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* user name color */</span></span><br><span class="line"><span class="selector-id">#ds-reset</span> <span class="selector-tag">span</span><span class="selector-class">.ds-user-name</span>, <span class="selector-id">#ds-reset</span> <span class="selector-tag">a</span><span class="selector-class">.ds-highlight</span>&#123;</span><br><span class="line">    <span class="comment">/*background-color: #777 !important;</span></span><br><span class="line"><span class="comment">border-color: #777 !important;</span></span><br><span class="line"><span class="comment">border-radius: 4px;</span></span><br><span class="line"><span class="comment">padding: 0 5px!important;*/</span></span><br><span class="line">    <span class="attribute">color</span>:<span class="number">#444</span> <span class="meta">!important</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码用途在注释中已有说明，不再赘述。最下面两块 <code>#ds-reset</code> 开头的样式会覆盖默认主题中的同名样式，以修改在主题中定义的用户名颜色，而不必本地化主题 CSS。  </p><p>##3. 修改 ds_embed.js<br>这一步非常重要，修改不慎就会导致整个评论框无法显示。而且这部分内容也与当前的多说 js 版本相关联。本文中提到的代码基于 2016-02-12 版本的 embed.js，如果今后多说修改了相关代码可能失效，到时我应该会更新。  </p><h3><span id="3-1-tian-jia-xin-han-shu">3.1 添加新函数</span><a href="#3-1-tian-jia-xin-han-shu" class="header-anchor">#</a></h3><p>首先在文件开头处添加三个新的函数：  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// admin reply</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sskadmin</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ssk = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(e.user_id==<span class="number">11838425</span>)&#123;</span><br><span class="line">        ssk = <span class="string">&#x27; sskadmin&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ssk;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// UA parser</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ua</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="keyword">new</span> <span class="built_in">Array</span>;</span><br><span class="line">    <span class="keyword">var</span> outputer = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (r = e.match(<span class="regexp">/MSIE\s([^\s|;]+)/gi</span>)) &#123;</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_ie&quot;&gt;IE &#x27;</span> + r[<span class="number">0</span>].replace(<span class="string">&#x27;MSIE&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/Edge\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_ie&quot;&gt;Edge &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/FireFox\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_firefox&quot;&gt;FireFox &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/Maxthon([\d]*)\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_maxthon&quot;&gt;Maxthon&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/UBrowser([\d]*)\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_ucweb&quot;&gt;UC &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/MetaSr/ig</span>)) &#123;</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_sogou&quot;&gt;Sougou&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/MicroMessenger\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_qq&quot;&gt;WeChat &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/QQBrowser\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_qq&quot;&gt;QQ &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/QQ\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_qq&quot;&gt;QQ &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/MiuiBrowser\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_mi&quot;&gt;MIUI &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/Chrome([\d]*)\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_chrome&quot;&gt;Chrome &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/safari\/([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_apple&quot;&gt;Safari &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/Opera[\s|\/]([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_opera&quot;&gt;Opera &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/Trident\/7.0/gi</span>)) &#123;</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_ie&quot;&gt;IE 11&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/weibo__([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> r1 = r[<span class="number">0</span>].split(<span class="string">&quot;__&quot;</span>);</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_qq&quot;&gt;Weibo &#x27;</span> + r1[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        outputer = <span class="string">&#x27;&lt;span class=&quot;ua_other&quot;&gt;奇怪♂的浏览器&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> outputer+<span class="string">&quot;&lt;/span&gt; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">os</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="keyword">new</span> <span class="built_in">Array</span>;</span><br><span class="line">    <span class="keyword">var</span> os = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (e.match(<span class="regexp">/Windows/ig</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.match(<span class="regexp">/NT 5.1/ig</span>)) &#123;</span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_xp&quot;&gt;Windows XP&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/NT 6.1/ig</span>)) &#123;</span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_7&quot;&gt;Windows 7&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/NT 6.2/ig</span>)) &#123;</span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_8&quot;&gt;Windows 8&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/NT 6.3/ig</span>)) &#123;</span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_8_1&quot;&gt;Windows 8.1&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/NT 10.0/ig</span>)) &#123;</span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_8_1&quot;&gt;Windows 10&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/NT 6.0/ig</span>)) &#123;</span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_vista&quot;&gt;Windows Vista&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/NT 5/ig</span>)) &#123;</span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_2000&quot;&gt;Windows 2000&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/Phone OS ([^\s]+)/ig</span>)) &#123;</span><br><span class="line">            <span class="comment">//WP7-7.5</span></span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_windows&quot;&gt;Windows &#x27;</span> + r[<span class="number">0</span>].split(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/Phone ([^\s]+)/ig</span>)) &#123;</span><br><span class="line">            <span class="comment">//WP8+</span></span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_windows&quot;&gt;Windows &#x27;</span> + r[<span class="number">0</span>].split(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            os = <span class="string">&#x27;&lt;span class=&quot;os_windows&quot;&gt;Windows&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/android ([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_android&quot;&gt;&#x27;</span> + r[<span class="number">0</span>].split(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/iPhone OS ([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_ios&quot;&gt;&#x27;</span> + r[<span class="number">0</span>].replace(<span class="string">&#x27;iPhone OS&#x27;</span>, <span class="string">&#x27;iPhone&#x27;</span>).replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;.&#x27;</span>).replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/CPU OS ([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_ios&quot;&gt;&#x27;</span> + r[<span class="number">0</span>].replace(<span class="string">&#x27;CPU OS&#x27;</span>, <span class="string">&#x27;iPad&#x27;</span>).replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;.&#x27;</span>).replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/ubuntu/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_ubuntu&quot;&gt;Ubuntu&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/linux/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_linux&quot;&gt;Linux&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r = e.match(<span class="regexp">/Mac OS X ([^\s]+)/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_mac&quot;&gt;&#x27;</span> + r[<span class="number">0</span>].split(<span class="string">&#x27;)&#x27;</span>)[<span class="number">0</span>].replace(<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;.&#x27;</span>).replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/unix/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_unix&quot;&gt;Unix&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/symbian/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_nokia&quot;&gt;Symbian&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.match(<span class="regexp">/meego/ig</span>)) &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_nokia&quot;&gt;MeeGo&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        os = <span class="string">&#x27;&lt;span class=&quot;os_other&quot;&gt;奇怪♂的操作系统&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> os+<span class="string">&quot;&lt;/span&gt;&quot;</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中第一个函数中的 <code>11838425</code> 是我的多说 user ID，在多说后台查看。<br>浏览器解析的部分我没有加入太多的国产壳浏览器解析，我觉得访问这个网站的人应该不会 low 到用大数字之类的奇怪浏览器吧。  </p><h3><span id="3-2-xiu-gai-shu-chu-ge-shi">3.2 修改输出格式</span><a href="#3-2-xiu-gai-shu-chu-ge-shi" class="header-anchor">#</a></h3><p>查找<br><code>r.url?(t+=&#39;&lt;a class=&quot;ds-user-name ds-highlight&quot;</code> …<br>这部分代码<br>在 class 中插入一段，变成：<br><code>r.url?(t+=&#39;&lt;a class=&quot;ds-user-name&#39;+sskadmin(s.author)+&#39; ds-highlight&quot; data-qqt-account=&quot;&#39;+(r.</code> …<br>这步是添加了站长回复的标记<br>后边不远处有一段<br><code>t+=&#39; data-qqt-account=&quot;&#39;+(r.qqt_account||&quot;&quot;)+&#39;&quot;&gt;&#39;+u(r.name)+&quot;&lt;/span&gt;&quot;),</code><br>在这后面插入以下代码：  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UA parse</span></span><br><span class="line">t+=<span class="string">&#x27;&lt;span class=&quot;ua&quot;&gt;&#x27;</span> + ua(s.agent) +<span class="string">&#x27;&lt;/span&gt;&lt;span class=&quot;ua&quot;&gt;&#x27;</span>+ os(s.agent) + <span class="string">&#x27;&lt;/span&gt;&#x27;</span>,</span><br></pre></td></tr></table></figure><p>这一步是添加了 UA 信息显示<br>更新网站，查看评论框效果，如果评论框不显示则说明 JS 写得有问题，可能的原因有：  </p><ol><li>多说 JS 版本更新了，部分对象名改变；  </li><li>你复制错了。(*/ω＼*)  </li></ol><p>修改后的完整代码在 GitHub: <a href="https://github.com/SykieChen/hexo-theme-hic17/blob/81343b17064034d09d1c51d6e44829dcbb57a5eb/source/js/ds_embed.js">https://github.com/SykieChen/hexo-theme-hic17/blob/81343b17064034d09d1c51d6e44829dcbb57a5eb/source/js/ds_embed.js</a>  </p><p>本文的所有修改均已合并到 HiC17 Hexo主题中。地址： <a href="https://github.com/SykieChen/hexo-theme-hic17">https://github.com/SykieChen/hexo-theme-hic17</a>  </p><hr><p>参考了：<br><a href="http://myhloli.com/duoshuo-ua-and-admin-tab.html">http://myhloli.com/duoshuo-ua-and-admin-tab.html</a><br><a href="http://ssk.91txh.com/209">http://ssk.91txh.com/209</a><br><a href="https://segmentfault.com/a/1190000002707162">https://segmentfault.com/a/1190000002707162</a>  </p><hr><p align="right">by Sykie Chen2016.2.12</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
            <tag> CSS </tag>
            
            <tag> 前端 </tag>
            
            <tag> 多说 </tag>
            
            <tag> JS </tag>
            
            <tag> UA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Favicon 站点图标的各平台适配与移动端优化</title>
      <link href="posts/cknp0yia8000d0zo6frmn06s5/"/>
      <url>posts/cknp0yia8000d0zo6frmn06s5/</url>
      
        <content type="html"><![CDATA[<p>网站的 favicon 图标在各平台上的显示效果很难保证。而这个图标又是网站识别的重要组成部分。这里详细介绍一下在 Android, iOS 以及 Windows 三大平台上网站图标效果的优化。  </p><span id="more"></span><p>##1. favicon 图标的格式<br>早期网站多使用 ico 格式，该格式允许一个文件里同时包含多个分辨率版本的图标。缺点是显示时必须拉取整个文件，若嵌入的图标较大则会导致不必要的带宽开销。<br>而如今更流行的是嵌入多个 png 格式图标并作出分别说明，根据需要拉取合适的图标即可。这样的缺点是需要写入很多行的 meta 标签。  </p><p>##2. favicon 图标的大小<br>这就是一个大坑了。<br>桌面端浏览器中，图标为 16×16；添加到 Windows 任务栏的时候，需要 32×32 以及 48×48 大小。<br>而 Windows 8 以上的磁贴界面中，我们还需要 70×70, 144×144, 150×150, 310×150, 310×310 大小的图标，以及指定的背景颜色。<br>而在移动端就更加令人呵呵呵了。早期非 Retina 屏幕的 iOS 设备中只需要 57×57，而 iPad 和 Retina 屏幕出现后，要想完成强迫症的完美适配，你需要8种尺寸的图标：  </p><table><thead><tr><th>Device</th><th>Screen</th><th>iOS ver</th><th>Size</th></tr></thead><tbody><tr><td>iPhone</td><td>Classic</td><td>6-</td><td>57×57</td></tr><tr><td></td><td></td><td>7+</td><td>60×60</td></tr><tr><td></td><td>Retina</td><td>6-</td><td>114×114</td></tr><tr><td></td><td></td><td>7+</td><td>120*120</td></tr><tr><td>iPad</td><td>Classic</td><td>6-</td><td>72×72</td></tr><tr><td></td><td></td><td>7+</td><td>76×76</td></tr><tr><td></td><td>Retina</td><td>6-</td><td>144×144</td></tr><tr><td></td><td></td><td>7+</td><td>152×152</td></tr></tbody></table><p>诶嘿嘿，是不是很酸爽啊胖友？这才哪到哪啊。  </p><p>还有 Android / Chrome 呢=。=<br>根据屏幕分辨率不同，要想完美适配 Android 系统的添加到桌面功能，你还需要 36×36, 48×48, 72×72, 96×96, 144×144, 192×192 的图标。以及在移动版 Chrome 中还有一个新加入的标签来指定多任务视图的标题颜色。  </p><p>你可能发现有很多尺寸在不同平台上有重复的嘛，然后开始怀疑我在吓唬人。好吧，虽然尺寸是一样的，然而如果你在 Android 平台上看到一个 iOS 风格的圆角矩形图标下面写着 HKEY_C17，你想不想分分钟砍死我啊诶嘿嘿？<br>所以我们需要为不同的平台准备不同的基础图标。<br>啊还有 Safari 的单色图标我还没说呢。<br>做一个前端是不是棒棒哒？诶嘿嘿嘿嘿爱我你怕了么（逃<br><img src="/blogimg/20160126-favicon/1.png">  </p><p>##3. 人民的大救星：<a href="http://realfavicongenerator.net/">RealFaviconGenerator</a><br>前端的朋友们还是有救的，这个萌萌哒平台可以生成我们需要的所有东西。<br>首先打开 <a href="http://realfavicongenerator.net/">http://realfavicongenerator.net/</a> 会让你上传高清基础图标，最好是270像素以上。<br>上传并生成后，可以单独修改各平台的显示参数或单独上传图标。这里推荐做一个透明背景带阴影的 Android 版、一个自带白色背景和阴影的 iOS 版，和一个无阴影无背景还把文字镂空了的 Safari 版。<br><img src="/blogimg/20160126-favicon/2.png"><br>iOS 效果如图  </p><p><img src="/blogimg/20160126-favicon/3.png"><br>Android 效果如图  </p><p><img src="/blogimg/20160126-favicon/4.png"><br>单独设置镂空文字的 Safari 版本后如图，避免色块里的文字无法显示。  </p><p><img src="/blogimg/20160126-favicon/5.png"><br>镂空并单色化的 Windows 磁贴效果  </p><p>然后在最下面填入你的图标需要放置的相对路径，就可以生成图标包和对应的 HTML 代码辣！<br><img src="/blogimg/20160126-favicon/6.png"><br>单击下载图标包，来让我们看看都放了啥在里面：<br><img src="/blogimg/20160126-favicon/7.png"><br>29个文件！天了噜！少掉了多少头发啊！<br>然后复制 HTML 代码插到你的 head 里面就行辣！<br>我的代码如下：  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;57x57&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-57x57.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;60x60&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-60x60.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;72x72&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-72x72.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;76x76&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-76x76.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;114x114&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-114x114.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;120x120&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-120x120.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;144x144&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-144x144.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;152x152&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-152x152.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;180x180&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/apple-touch-icon-180x180.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/png&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/favicon-32x32.png&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;32x32&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/png&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/android-chrome-192x192.png&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;192x192&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/png&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/favicon-96x96.png&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;96x96&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/png&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/favicon-16x16.png&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;16x16&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;manifest&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/manifest.json&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;mask-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/safari-pinned-tab.svg&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#5bbad5&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/images/favicon.ico&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;msapplication-TileColor&quot;</span> <span class="attr">content</span>=<span class="string">&quot;#2d89ef&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;msapplication-TileImage&quot;</span> <span class="attr">content</span>=<span class="string">&quot;/css/images/mstile-144x144.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;msapplication-config&quot;</span> <span class="attr">content</span>=<span class="string">&quot;/css/images/browserconfig.xml&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;theme-color&quot;</span> <span class="attr">content</span>=<span class="string">&quot;#330066&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Android 效果如图：<br><img src="/blogimg/20160126-favicon/8.png"><br><img src="/blogimg/20160126-favicon/9.png">  </p><p>iOS 因为 Pad 放在客厅我懒得拿了就不截图了哈哈哈哈哈哈我就是这么跳你自己测去啊哈哈哈（欠打脸）  </p><p>全部部署完成后，可以单击下面的 check your favicon 测试一下部署是否成功。<br>感谢 Real Favicon Generator，如果可能的话可以点击下面的链接捐助他们！<br><a href="http://realfavicongenerator.net/donate">http://realfavicongenerator.net/donate</a>  </p><p align="right">by Sykie Chen2016.1.26</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> favicon </tag>
            
            <tag> HTML </tag>
            
            <tag> CSS </tag>
            
            <tag> 前端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何在污染指数800+的北京活下去：关于防雾霾半面罩的选择</title>
      <link href="posts/cknp0yia7000c0zo67pgw79dd/"/>
      <url>posts/cknp0yia7000c0zo67pgw79dd/</url>
      
        <content type="html"><![CDATA[<p>##0.1 污染情况##</p><p>最近北京的空气又爆炸，污染300多已经算低了。昨天晚上空气指数400多的时候下楼拿外卖，一进走廊就能明显感觉到嗓子火辣辣的，我立刻回头戴上了 9502 口罩，然而电梯到一楼一开门时隔着口罩也能闻到空气中呛人的味道。一出楼门，能见度不足二十米，甚至觉得眼睛都开始不适。隔着口罩也能感觉到空气的味道更加明显。</p><span id="more"></span><p>前段时间空气污染 800+ 的时候我曾经用两天时间将一个 9501V 口罩戴得漆黑一片。加上最近嗓子不舒服的频率越来越高，我决定好好研究一下呼吸防护的问题。</p><p>##0.2    防护手段##<br>首先要明确一下各种呼吸防护等级标准，如下表：<br><img src="/blogimg/20151213-masks/1.jpg"><br>N只防干性颗粒，P与R可以防油性颗粒。不幸的是，机动车尾气大部分由油性颗粒组成。交通部说空气污染是供暖的锅，住建部说空气污染是汽车尾气的锅。根据我戴 9502 口罩还能闻到雾霾味道这个情况来看，我倾向于相信住建部的说法。即佩戴 N95 等级的口罩（如 3M 9501/9502）并不能完全抵御雾霾。N90 等级（如 3M9001/9002/9003(V)）的就更别提了。<br>我又查阅了 P95 等级口罩（如 3M 8577/8576），售价均为 20+ RMB，根据之前重污染时2-3天更换一个的频率我是难以负担的。相比于 N95 口罩2-3 RMB 的售价不知高到哪里去了。<br>在查阅的过程中我了解到不光可以戴口罩，还可以直接上可以重复使用的面罩。面罩首次购买成本较高，但使用时更换的耗材成本相较于一次性口罩低了不少。<br>面罩就分为半面罩和全面罩。全面罩如图所示，随便感受一下。<br><img src="/blogimg/20151213-masks/2.png"><br>生化危机既视感。戴出去太夸张了，而且售价也十分可观，图里的 6800 七件套 400+ RMB。<br>半面罩没有护目镜部分，造型更加正常一些，价格也在可以接受的程度内。<br>3M 的面罩有一大堆：<br><img src="/blogimg/20151213-masks/3.png"><br>卖的比较好的主要有 6000、7500 和 3000 系列，别的有什么区别我也没太看出来，就不研究了。<br>半面罩的主要组成有本体、滤毒盒、过滤棉和过滤棉盖。不使用滤毒盒时可以将滤毒盒更换为过滤棉底座+过滤棉或直接接过滤棉。具体的图见下。下面分别讲一下各部分。</p><p>##1. 面罩主体##<br>3000 系列有 3100 小号、3200 中号和 3300 大号，分别给女性、男性和大脸男性使用。<br>说我要用 3300 那些你们过来，我保证不打死你们。<br>###1.1 3000 系列###<br>有一个滤毒盒承接口，应对平时的小流量呼吸无压力，运动时佩戴可能就比较捉急了。<br>3200 面罩搭配滤棉底座如图：<br><img src="/blogimg/20151213-masks/4.png"><br>3200 搭配滤毒盒如图：<br><img src="/blogimg/20151213-masks/5.png"></p><p>###1.2 6000 系列###<br>有两个滤毒盒/过滤棉接口，可以应对大流量的呼吸，阻力较小，缺点是造型太特么夸张了，而且很重，戴久了脖子必然难受。同样分为 6100/6200/6300 对应不同大小的脸。<br>6200 的各种搭配如图：<br><img src="/blogimg/20151213-masks/6.png"><br>配滤毒盒的戴上效果如图：<br><img src="/blogimg/20151213-masks/7.png"><br>###1.3 7500 系列###<br>跟 6000 系列的区别基本只在于 7500 是硅橡胶的，更舒服一点。同样分为 7501/7502 对应脸部大小。<br>7502 如图：<br><img src="/blogimg/20151213-masks/8.png"></p><p>##2. 过滤棉##<br>过滤棉对应不同的面罩有不同的型号，根据国家标准 GB2890-2009，等级分为三种：<br><img src="/blogimg/20151213-masks/9.png"><br>即最基本的 P1 型也有 N95 的过滤效果。<br>在 3M 官网摘抄如下：<br><img src="/blogimg/20151213-masks/10.png"><br>来源：<a href="http://multimedia.3m.com/mws/media/483537O/7500.pdf">http://multimedia.3m.com/mws/media/483537O/7500.pdf</a></p><p>其中 2000 系列滤棉直接接在面罩上，5N/3N 系列滤棉要配合滤毒盒使用。<br>3N11 滤棉的图参考上面 3200 面具的图。<br>2091 滤棉如图所示：<br><img src="/blogimg/20151213-masks/11.png"><br>迷人的粉色，妹子可以考虑一下=。=</p><p>##3. 滤毒盒##<br>终于到了重点了，滤毒盒这个东西如果不装的话，面罩的优势就体现不出来了。<br>一个滤毒盒可以使用一个月左右（每天8小时）。主要分类如下：<br><img src="/blogimg/20151213-masks/12.png"></p><p>所有的滤毒盒上都有颜色环，颜色遵循国家标准 GB2890-2009：<br>来源：<a href="http://www.fjcodc.com.cn/article/download.jsp?ufid=769&amp;idx=0">http://www.fjcodc.com.cn/article/download.jsp?ufid=769&amp;idx=0</a><br><img src="/blogimg/20151213-masks/13.png"><br>常用的有 6001/3301 和 6003/3303 滤毒盒，6000 和 3300 系列分别对应相应的半面具。<br>6001/3301 主要防有机气体，褐色环：<br><img src="/blogimg/20151213-masks/14.png"><br>6003/3303 还兼防二氧化硫气体，褐色、黄色双环，但是比 6001/3301 贵二十多块钱，不过我觉得这个钱还是有必要的，毕竟尾气里二氧化硫含量不低。<br><img src="/blogimg/20151213-masks/15.png"><br>##4. 总结##<br>终于简单地说完了，各种型号真是要人命。总结起来我决定买 3200面具 + 3303滤毒盒 + 3N11滤棉 组合，全套售价 60-70 元左右，每周更换一次 3N11 滤棉，售价 1.6 元，每月更换一次  3303 滤毒盒，售价 34 元。<br>对于爱出汗的人有个神器，3M 389 吸汗垫，售价 2-3 元：<br><img src="/blogimg/20151213-masks/16.png"></p><p>这个组合基本在保命和看起来正常之间取得了平衡= =<br>其实这个污染情况看起来正不正常已经不那么重要了。我已经好几次在学校里看见戴着巨大的带俩滤毒盒的 6200 面罩的妹子了，在生存面前，好不好看先缓一缓吧。选择了北京为的是更好的发展环境，污染的空气也是选择的一部分。自己选的霾，跪着也要吸完。</p><p>最后不得不说，3M 真是人民的好帮手，生活的好伙伴啊= =<br><img src="/blogimg/20151213-masks/17.png"></p><p>祝大家生活健康，不被熏死= =<br>以上涉及产品在 <code>X宝</code> 都能买到，强烈要求 3M 公司付我广告费。<del>送我个面罩也是可以的=。=</del></p><p>参考：<br><a href="http://www.zhihu.com/question/38273401">http://www.zhihu.com/question/38273401</a><br><a href="http://www.zhihu.com/question/25953227">http://www.zhihu.com/question/25953227</a><br><a href="http://www.zhihu.com/question/20749979">http://www.zhihu.com/question/20749979</a><br><a href="http://www.fjcodc.com.cn/article/download.jsp?ufid=769&amp;idx=0">http://www.fjcodc.com.cn/article/download.jsp?ufid=769&amp;idx=0</a><br><a href="http://multimedia.3m.com/mws/media/652862O/2091p100.pdf">http://multimedia.3m.com/mws/media/652862O/2091p100.pdf</a><br><a href="http://multimedia.3m.com/mws/media/483537O/7500.pdf">http://multimedia.3m.com/mws/media/483537O/7500.pdf</a><br><a href="http://multimedia.3m.com/mws/media/5184O/particulate-filter-2096-p100.pdf">http://multimedia.3m.com/mws/media/5184O/particulate-filter-2096-p100.pdf</a></p><p align="right">by Sykie Chen2015.12.13</p>]]></content>
      
      
      <categories>
          
          <category> 小清新 </category>
          
          <category> 疯了个癫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 雾霾 </tag>
            
            <tag> 口罩 </tag>
            
            <tag> 面罩 </tag>
            
            <tag> 空气质量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mifare 1k S50 卡的简单探讨与破解</title>
      <link href="posts/cknp0yia300090zo6hxx96i0q/"/>
      <url>posts/cknp0yia300090zo6hxx96i0q/</url>
      
        <content type="html"><![CDATA[<p><strong>免责声明：本文仅供有能力的读者进行技术研究与探讨，本人在试验成功后已将卡片内数据改回。因阅读此文章而产生的一切后果与本人无关，一切责任由您自己承担。</strong></p><p><strong>警告：私自篡改 IC 卡内信息可能触犯法律，由于您自行改动您的卡片内的数据而引起的一切后果与本文作者无关。勿谓言之不预也。</strong></p><h2><span id="0-bei-jing">0. 背景</span><a href="#0-bei-jing" class="header-anchor">#</a></h2><p>&emsp;&emsp;学校公共洗衣机是用的是海尔的读卡洗衣机，与之配套的洗衣卡收费五十元，其中押金十元，内含十次洗衣次数，每次四元。</p><span id="more"></span><h2><span id="1-yuan-li">1. 原理</span><a href="#1-yuan-li" class="header-anchor">#</a></h2><p>&emsp;&emsp;尝试用带 NFC 的手机（Galaxy S6）搭配 <a href="https://play.google.com/store/apps/details?id=de.syss.MifareClassicTool">Mifare Classic Tool</a> （链接为 Google Play，墙内可以使用 <a href="http://apkleecher.com/">Apk Leecher</a> 下载 Play 上的安装包） 读取洗衣卡发现其为 Mifare 1k 卡片。此卡片的加密早在2008年就被破解，只要有一个扇区未加密就可破解出其它所有扇区的密钥。<br><img src="/blogimg/20151019-nfc-mod/1.png"></p><p>以下节选自 <a href="http://read.pudn.com/downloads102/doc/420451/M1%E5%8D%A1%E6%8A%80%E6%9C%AF%E6%89%8B%E5%86%8C[1].doc.doc">M1 卡技术手册</a> ：</p><ol><li>M1卡分为16个扇区，每个扇区由4块（块0、块1、块2、块3）组成，（我们也将16个扇区的64个块按绝对地址编号为0~63，存贮结构如下图所示：<br><img src="/blogimg/20151019-nfc-mod/2.png"></li><li>第0扇区的块0（即绝对地址0块），它用于存放厂商代码，已经固化，不可更改。</li><li>每个扇区的块0、块1、块2为<strong>数据块</strong>，可用于存贮数据。</li></ol><p><strong>数据块</strong>可作两种应用：</p><pre><code>- 用作一般的数据保存，可以进行**读、写**操作。- 用作数据值，可以进行**初始化值、加值、减值、读值**操作。</code></pre><ol start="4"><li>每个扇区的块3为<strong>控制块</strong>，包括了密码A、存取控制、密码B。具体结构如下：<br><img src="/blogimg/20151019-nfc-mod/3.png"></li><li>每个扇区的密码和存取控制都是独立的，可以根据实际需要设定各自的密码及存取控制。存取控制为4个字节，共32位，扇区中的每个块（包括数据块和控制块）的存取条件是由密码和存取控制共同决定的。<br>……</li></ol><h2><span id="2-cao-zuo">2. 操作</span><a href="#2-cao-zuo" class="header-anchor">#</a></h2><p><img src="/blogimg/20151019-nfc-mod/4.png"><br>如图，本卡中，所有区块的存取控制均为 FF 07 80 69 ，此值为 MF1 卡的出厂预设值，不必对照表格一步步解读，直接可以查得最后两位 69 无意义，前三位 FF 07 80 表示 0-2 三个块只要验证密码A或密码B即可读写。块3权限如下图：<br><img src="/blogimg/20151019-nfc-mod/5.png"><br>即：只有验证密码A正确了，才能做以下操作：<br>· 修改密码A；<br>· 修改控制字；<br>· 修改密码B，读出密码B。</p><p>可以看出，卡中只有第5扇区第1块中有数据，且为循环数据，猜测剩余次数存在此段数据中。除5扇区外其他扇区的密码A密码B均为 <code>FFFFFFFFFFFF</code>，第5扇区密码A未知，密码B为 <code>FFFFFFFFFFFF</code>。猜测为防止直接复制卡而修改了密码A，因此我采用直接复制整张卡的方法并不能读出正确的5扇区密码A。读卡机可能只使用密码A与卡通信，故复制卡试验时读卡机报错。<br>前文提到该卡已被破解，使用电脑连接读卡器可以方便地暴力猜解或通过验证漏洞破解密码A。但读卡器太特么贵了，并不能买得起。所以我们就不复制卡了。<br>然而虽然因密码A未知而不能复制，在密码B为默认密码的条件下可以直接用手机 NFC 修改5扇区1块的数据，无需复制卡片。<br><img src="/blogimg/20151019-nfc-mod/6.png"><br>在卡机上正常刷卡一次后再次读取数据并对比，可见每个循环节内只有一个字节被修改，确定这个字节代表的就是剩余次数。<br>经过比对得到如下已知的对应关系。其中有数据字串的行为实际读出，其他的行为推测得出。</p><table><thead><tr><th>剩余次数</th><th>数据字串</th><th>关键字节</th><th>前4位</th><th>后4位</th></tr></thead><tbody><tr><td>10</td><td>F05A11EE00</td><td>5A</td><td>5</td><td>A</td></tr><tr><td>9</td><td>F06911EE00</td><td>69</td><td>6</td><td>9</td></tr><tr><td>8</td><td></td><td>78</td><td>7</td><td>8</td></tr><tr><td>7</td><td></td><td>87</td><td>8</td><td>7</td></tr><tr><td>6</td><td>F09611EE00</td><td>96</td><td>9</td><td>6</td></tr><tr><td>5</td><td></td><td>A5</td><td>A</td><td>5</td></tr><tr><td>4</td><td>F0B411EE00</td><td>B4</td><td>B</td><td>4</td></tr><tr><td>3</td><td>F0C311EE00</td><td>C3</td><td>C</td><td>3</td></tr><tr><td>2</td><td></td><td>D2</td><td>D</td><td>2</td></tr><tr><td>1</td><td></td><td>E1</td><td>E</td><td>1</td></tr></tbody></table><p>规律很简单。直接修改此字节即可完成洗衣卡次数的修改。</p><h2><span id="3-yan-zheng-yu-shou-wei">3. 验证与收尾</span><a href="#3-yan-zheng-yu-shou-wei" class="header-anchor">#</a></h2><p><img src="/blogimg/20151019-nfc-mod/7.png"><br>用 Mifare Classic Tool 写入数据，在卡机上测试成功显示十次。成功。<br><del>没有测试10以上的次数，因为新卡买回来就是十次。然而理论上应该最多可以修改为15次。有空再测试。</del><br>因为 <del>闲得蛋疼</del> 追求极致，我斗胆测试了 <code>0F</code> ，居然成功显示了15次。<br><img src="/blogimg/20151019-nfc-mod/8.png"><br><img src="/blogimg/20151019-nfc-mod/9.png"><br>然后就脑洞大开，最前面的 <code>F0</code> 会不会也是数据位呢？<br>于是测试了 <code>E10F</code> 。<br><img src="/blogimg/20151019-nfc-mod/10.png"><br><img src="/blogimg/20151019-nfc-mod/11.png"><br>哈哈哈哈居然真的显示31次。<br>我有一种要玩坏的预感。理论上限应该是255次吧，然而洗衣机上只有三位数码管，最多只能显示到99.0。好吧那就试试99.0。<br>把99转换成十六进制是63，所以写入 <code>96C3</code> 。<br><img src="/blogimg/20151019-nfc-mod/12.png"><br><img src="/blogimg/20151019-nfc-mod/13.png"><br>作死成功，这实在是太E可赛艇了。θ..θ</p><p>将数据修改回去，避免产生法律纠纷。</p><p>此次修改严格来说并没有什么技术含量，这个洗衣卡硬件本身已经不安全，又使用弱口令，破解不费吹灰之力。然而洗衣服并不要多贵，破解它所获取的仅仅是 Mifare 卡片相关的知识。</p><p>此外，这种卡片是离线卡片，并没有服务器存储余额，因此可以破解。而公交卡、校园卡等卡片使用时会在线验证，与服务器上的余额数据比对，因此即使数据能读取修改，也无法真正修改余额，除非连人家的服务器一块儿黑了。</p><p>最后再次声明，本文仅用于技术学习与探讨。您阅读本文后进行的一切操作及其引起的后果与本文作者无关，本人不承担任何责任。</p><p align="right">by Sykie Chen2015.10.192015.10.23 mod</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> NFC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NFC </tag>
            
            <tag> Mifare </tag>
            
            <tag> RFID </tag>
            
            <tag> IC卡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>联想 Y580 V8.01 BIOS 的更新</title>
      <link href="posts/cknp0yia200080zo6h1kv7y6g/"/>
      <url>posts/cknp0yia200080zo6h1kv7y6g/</url>
      
        <content type="html"><![CDATA[<p>&emsp;&emsp;<a href="http://www.devchen.com/blog/coding/Windows/20150903-win81-usb3/">上篇文章</a>里提到 Windows 8.1 中休眠后 USB 3.0 设备识别为 2.0 的问题。操作后确实可以解决睡眠和休眠后设备识别的问题，但 Win8.1 快速关机（假关机）后再启动又会识别为 2.0 设备。查找资料后确定为 BIOS 版本过老与 USB 3.0 及 Win8 兼容性不佳的问题。故刷新 BIOS。<br>&emsp;&emsp;美帝良心企业联想在国内发售的 Y580 行货均为 1366*768 低分屏，且 Win8 推出后并没有相应预装的版本。官网可下载到最新的 BIOS 固件版本为 5DCN40WW V2.07。该版本是针对 Win7 优化的。而 Y580 美版不仅有1080高分屏版本，还有预装了 Win8 的版本。该版本内置的 BIOS 版本为 5DCN90WW V8.01，该版本更好地支持了 Win8 的一些新特性，比如 UEFI 等。这里我只需要对 USB 3.0 更好的兼容性。</p><span id="more"></span><p>&emsp;&emsp;参考贴吧帖子 <a href="http://tieba.baidu.com/p/3959740413">http://tieba.baidu.com/p/3959740413</a> 。此处刷新的是含 EC 的完整版本。</p><ol><li>8.01 的 BIOS 刷新只能在纯 DOS 下进行，在<a href="http://pan.baidu.com/s/1sjl725R">这里</a>（提取码 ica4）下载 DOS 7 的 iso 镜像，用 UltraISO 写入U盘引导。</li><li>下载<a href="http://pan.baidu.com/s/1kTGlVoz">BIOS刷新包</a>（提取码 4b4a）解压后将 DOS 目录中所有文件拷入U盘。</li><li>重启，按 F12 选择U盘启动。键入 haltME.bat 回车，锁定 EC BIOS，完成后会自动重启。</li><li>再按 F12 进 DOS，运行 flash.bat 刷新 BIOS。屏幕会显示警告不要断开交流电，搞得我很紧张，难道电池不能供电么。<br><img src="/blogimg/20151002-Y580-bios/1.jpg"></li><li>刷完自动重启，按 F2 进入 BIOS ，Boot -&gt; Boot Mode -&gt; Legacy Support 。起初我没选导致找不到U盘引导，默认的 UEFI 只能识别硬盘上的 Win8。<br><img src="/blogimg/20151002-Y580-bios/2.jpg"></li><li>重启进入 DOS，运行 unhaltME.bat，解锁 EC。</li><li>重启进入 BIOS，Load Default，保存重启。</li></ol><p>&emsp;&emsp;刷好以后如图，启动时 Windows 的 logo 会变为联想 logo ，且闪屏的分辨率提升了。进入系统后反复测试发现 USB 3.0 的问题已经彻底解决。<br><img src="/blogimg/20151002-Y580-bios/3.jpg"><br><img src="/blogimg/20151002-Y580-bios/4.jpg"><br>###可能存在的问题###<br>如果刷完进不去系统了，说明系统分区表不是 GPT ，不支持 UEFI。重复照第五步操作后，使用 DiskGenius 等分区软件将系统分区转为 GPT 分区表。</p><p align="right">by Sykie Chen2015.10.2</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> DOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Y580 </tag>
            
            <tag> 联想 </tag>
            
            <tag> BIOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows 8.1 USB 3.0 速度异常的处理</title>
      <link href="posts/cknp0yia100070zo66x0fa2be/"/>
      <url>posts/cknp0yia100070zo66x0fa2be/</url>
      
        <content type="html"><![CDATA[<p>&emsp;&emsp;Windows 8.1 已经内建 USB 3.0 控制器驱动，正常情况下无需单独安装 USB 3.0 驱动程序。但有时由于兼容性问题或电源策略问题，系统睡眠并重新唤醒后 USB 3.0 端口无法正常工作，现象为 USB 3.0 设备传输速度限制在 30MB/s 上下，系统识别端口为 USB 2.0 端口。如图，设备和打印机中查看 3.0 设备时提示可在 3.0 端口上获得更快速度。<br><img src="/blogimg/20150903-win81-usb3/1.png"></p><span id="more"></span><p>&emsp;&emsp;首先强制重新安装驱动。在<a href="https://downloadcenter.intel.com/download/22824/USB-3-0-Driver-Intel-USB-3-0-eXtensible-Host-Controller-Driver-for-Intel-8-9-100-Series-and-C220-C610-Chipset-Family">英特尔官网</a>下载最新版本驱动程序。此时若直接安装会提示系统版本不正确，无法安装。<br>&emsp;&emsp;进入 <code>\Drivers\Win7</code> 下与系统版本对应（32/64位）的目录，右键 <code>iusb3hub.inf</code> 和 <code>iusb3xhc.inf</code> 安装。<br>&emsp;&emsp;在设备管理器中双击 USB 设备中最下面的 <code>USB Root Hub (xHCI)</code>，在电源管理选项卡中取消选择“允许计算机关闭此设备以节约电力”。<br><img src="/blogimg/20150903-win81-usb3/3.png"><br>&emsp;&emsp;重启电脑。<br>&emsp;&emsp;在设备和打印机中重新查看设备工作状态，提示已插入 3.0 端口。测速 200+MB/s。 休眠并唤醒后不变。Done.<br><img src="/blogimg/20150903-win81-usb3/2.png"></p><p align="right">by Sykie Chen2015.9.6</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows 8.1 </tag>
            
            <tag> USB 3.0 </tag>
            
            <tag> Intel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shadowsocks + obfsproxy 混淆翻墙的实现</title>
      <link href="posts/cknp0yi9v00030zo6ei1h03lq/"/>
      <url>posts/cknp0yi9v00030zo6ei1h03lq/</url>
      
        <content type="html"><![CDATA[<p>&emsp;&emsp;Shadowsocks 的作者 <a href="https://twitter.com/clowwindy">@clowwindy</a> 近期被喝茶了，并被迫删除了 Github 上的源码。这意味着 ss 以后不会得到更新，其流量特征也许会被不断进化的 GFW 识别并封锁。故使用 obfsproxy 进行二次混淆，降低被识别的风险。<br>&emsp;&emsp;以下步骤均在 Debian 7 32 位系统上进行。</p><h2><span id="1-pei-zhi-shadowsocks-libev-fu-wu-duan">1. 配置 shadowsocks-libev 服务端</span><a href="#1-pei-zhi-shadowsocks-libev-fu-wu-duan" class="header-anchor">#</a></h2><p>参考<a href="https://github.com/shadowsocks/shadowsocks-libev">官方文档</a>，这里从源直接安装。</p><p>添加 GPG public key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O- http://shadowsocks.org/debian/1D27208A.gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure><span id="more"></span><p>向 <code>/etc/apt/sources.list</code> 添加以下内容</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb http:<span class="regexp">//</span>shadowsocks.org/debian wheezy main</span><br></pre></td></tr></table></figure><p>执行以下命令安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install shadowsocks-libev</span><br></pre></td></tr></table></figure><p>安装完成后编辑<code>/etc/shadowsocks-libev/config.json</code> 文件配置加密方式与端口</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>:<span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span>:<span class="number">2333</span>,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>:<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>:<span class="string">&quot;---&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>:<span class="number">600</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>:<span class="string">&quot;aes-256-cfb&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>server 填写 0.0.0.0 允许所有设备连接，填写 127.0.0.1 则仅允许本机内环连接。<br>加密方式一般选择 aes-256-cfb。<br>配置完成后执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/shadowsocks-libev start</span><br></pre></td></tr></table></figure><p>启动ss服务端。</p><h2><span id="2-pei-zhi-shadowsocks-ke-hu-duan-windows-ping-tai">2. 配置 shadowsocks 客户端（Windows 平台）</span><a href="#2-pei-zhi-shadowsocks-ke-hu-duan-windows-ping-tai" class="header-anchor">#</a></h2><p>在 <a href="http://shadowsocks.org/en/download/clients.html">http://shadowsocks.org/en/download/clients.html</a> 下载 win 客户端<br>启动后在 GUI 中填写服务器信息并保存，本地端口以666举例。<br>右击托盘图标以配置开机启动，将代理方式设置为 PAC。视情况使用 PAC 脚本或搭配 SwitchyOmega + Chrome 使用。<br>若连接正常，则继续进行 obfsproxy 的部署。</p><p>##3. 配置 obfsproxy 服务端 ##</p><p>使用 python-pip 安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gcc python-pip python-dev</span><br><span class="line">pip install obfsproxy</span><br></pre></td></tr></table></figure><p>运行服务端：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/bin/obfsproxy --data-dir=/tmp/scramblesuit-server scramblesuit --password=FANGBINXINGFUCKYOURMOTHERSASS444 --dest=127.0.0.1:2333 server 0.0.0.0:23333</span><br></pre></td></tr></table></figure><p>scramblesuit 是一种安全性稍高的加密工作方式，该方式工作时需要临时文件夹存放yaml ticket，故用 –data-dir 参数指定目录。–password 指定了加密密码，必须为 BASE32 字符，即大写字母加数字共32位的字符串。<br>–dest 指定目标端口，此处填写 ss 服务端口。 server 为混淆后对外监听端口，0.0.0.0 表示允许所有网段地址连接。<br>运行成功后会提示</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2015</span><span class="number">-08</span><span class="number">-25</span> <span class="number">21</span>:<span class="number">22</span>:<span class="number">02</span>,<span class="number">412</span> [WARNING] Obfsproxy (version: <span class="number">0.2</span><span class="number">.13</span>) starting up.</span><br><span class="line"><span class="number">2015</span><span class="number">-08</span><span class="number">-25</span> <span class="number">21</span>:<span class="number">22</span>:<span class="number">02</span>,<span class="number">412</span> [ERROR]</span><br><span class="line">################################################</span><br><span class="line">Do NOT rely on ScrambleSuit for strong security!</span><br><span class="line">################################################</span><br></pre></td></tr></table></figure><p>并不知道那句 [ERROR] 是什么意思，所以不要理它好了=。=<br>启动成功后需要将其加入自启动。编辑<code>/etc/rc.local</code> 文件添加如下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(/usr/<span class="built_in">local</span>/bin/obfsproxy --data-dir=/tmp/scramblesuit-server scramblesuit --password=FANGBINXINGFUCKYOURMOTHERSASS444 --dest=127.0.0.1:2333 server 0.0.0.0:23333 &gt;/dev/null 2&gt;&amp;1 &amp;)</span><br></pre></td></tr></table></figure><p>包括最外层括号。<br>重启 VPS，服务端应已开始工作。</p><p>##4. 配置 obfsproxy 客户端 ##</p><p>Tor 并没有提供单独的 obfsproxy 客户端下载，需要手动从 Tor Browser 安装包中提取。<br>在 <a href="https://www.torproject.org/projects/obfsproxy.html.en">https://www.torproject.org/projects/obfsproxy.html.en</a> 下载 Tor Browser with obfsproxy<br>下载后作为压缩包打开，定位至 <code>Browser\TorBrowser\Tor\PluggableTransports\</code><br>由于客户端程序有依赖，故将该目录下除子目录 fteproxy 外的所有文件提取至单独文件夹中。<br>运行客户端：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obfsproxy\obfsproxy.exe scramblesuit --password=FANGBINXINGFUCKYOURMOTHERSASS444 --dest=www.devchen.com:<span class="number">23333</span> client <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6666</span></span><br></pre></td></tr></table></figure><p>运行成功的提示与服务端的类似。<br>客户端将运行在本机 6666 端口上，修改 shadowsocks 客户端参数，服务器地址填入 127.0.0.1，端口 6666。测试连接是否成功。<br>将客户端加入 Windows 自启动。由于启动后会产生一个控制台窗口，故需要用 vbs 启动客户端以隐藏控制台窗口。</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CreateObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>).Run <span class="string">&quot;obfsproxy\obfsproxy.exe scramblesuit --password=FANGBINXINGFUCKYOURMOTHERSASS444 --dest=www.devchen.com:6667 client 127.0.0.1:4243&quot;</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure><p>存为 VBS 文件，到<code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</code>(Windows 8.1)</p><p>##5. 总结 ##</p><p>全部完工后端口如下：<br>服务端：<br>2333   -   Shadowsocks 服务端口<br>23333  -   obfsproxy 转发服务端口</p><p>客户端：<br>666    -   Shadowsocks 代理服务端口<br>6666   -   obfsproxy 转发服务端口</p><p>加入 obfs 混淆后访问速度及稳定性明显增加。</p><p align="right">by Sykie Chen2015.8.25</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> VPS </tag>
            
            <tag> 科学上网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>三星 Galaxy S6 的 SystemUI 修改与功能添加</title>
      <link href="posts/20150710-sgs6-mod/"/>
      <url>posts/20150710-sgs6-mod/</url>
      
        <content type="html"><![CDATA[<p>5.0系统下 xposed 框架不稳定且对三星 TouchWiz 支持不佳，故手动反编译并修改 SystemUI 添加部分常用功能。<br>部分内容源于 xda 论坛等。用 apktool 反编译。<br>注意，使用 apktool 2.0 版本无法正常回编译 SystemUI.apk，此处使用 2.0 RC3 版本，可正常编译。<br>基于 SM-G9200 大陆公开版 G9200ZCU1AOE4 固件。</p><h2><span id="1-dian-liang-shu-zi-da-xiao-xiu-gai">1. 电量数字大小修改</span><a href="#1-dian-liang-shu-zi-da-xiao-xiu-gai" class="header-anchor">#</a></h2><p>默认电量百分比的数字字号太大了，占用过多空间。<br><code>SystemUI\res\values\dimens.xml</code> 971行  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;battery_text_marginStart&quot;</span>&gt;</span>0.0dip<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;battery_text_size&quot;</span>&gt;</span>9.0dip<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><span id="more"></span><h2><span id="2-yi-dong-wang-luo-duan-kai-shi-bu-xian-shi-g-e-3g-4g">2.移动网络断开时不显示G/E/3G/4G</span><a href="#2-yi-dong-wang-luo-duan-kai-shi-bu-xian-shi-g-e-3g-4g" class="header-anchor">#</a></h2><p>修改 <code>/System/build.prop</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ro.product.name=zerofltezc</span><br><span class="line">ro.product.device=zerofltechn</span><br></pre></td></tr></table></figure><p>改为</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ro.product.name=zeroflte</span><br><span class="line">ro.product.device=zeroflte</span><br></pre></td></tr></table></figure><p>如此可达到最初目的，即断开移动网络时隐藏网络类型指示器。但似乎并不稳定，更改机型可能导致某些专用软件的兼容性问题，也可能影响 Smart Switch 的识别。故修改布局与图片资源使网络类型指示器与信号重叠变通解决。</p><p><code>systemui\layout\msim_signal_cluster_view.xml</code><br>将 separate_mobile 下的 inout 和 mobiletype 移动到 mobile_combo 下。<br>注意，卡1有两个 mobile_combo ，第一个 sub3 平时并不显示，怀疑是电信卡的双信号格，移动的时候注意放到不带 sub 的 frame 中，卡2无此问题，只有一个 sub2<br>改动后替换 png 资源防止文字重叠。覆盖即可。<br>png图标包：<a href="http://pan.baidu.com/s/1i3F2YiD">http://pan.baidu.com/s/1i3F2YiD</a></p><p>##3. 隐藏下拉的 S 搜索、快速连接 ##</p><p><code>SystemUI.apk\smali\com\android\systemui\statusbar\phone\PhoneStatusBar.smali</code> 找到并修改如下内容</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span> showHideQConnectLayout()V</span><br><span class="line"><span class="keyword">    .locals</span> 13</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .prologue</span></span><br><span class="line">   <span class="built_in"> const/16 </span>v12, 0x64</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v11, 0x1</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/16 </span>v10, 0x8</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v9, 0x0</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 7422</span><br><span class="line">   <span class="built_in"> iget-boolean </span>v6, p0, <span class="class">Lcom/android/systemui/statusbar/phone/PhoneStatusBar;</span>-&gt;mShowSFinderQConnectView:Z</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> if-eqz </span>v6,<span class="keyword"> :cond_6</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> iget-object </span>v6, p0, <span class="class">Lcom/android/systemui/statusbar/phone/PhoneStatusBar;</span>-&gt;mQconnectSfinderView:<span class="class">Lcom/android/systemui/statusbar/QconnectSfinderView;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> if-nez </span>v6,<span class="keyword"> :cond_0</span> //0改为6</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> iget-object </span>v6, p0, <span class="class">Lcom/android/systemui/statusbar/phone/PhoneStatusBar;</span>-&gt;mQsQConnectView:<span class="class">Landroid/view/View;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in"> if-eqz </span>v6,<span class="keyword"> :cond_6</span></span><br></pre></td></tr></table></figure><p>##4. 隐藏状态栏 卡1 卡2 图标 ##</p><p><code>systemui\layout\msim_signal_cluster_view.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">android:id</span>=<span class="string">&quot;@id/sim_icon_chn&quot;</span> <span class="attr">android:layout_width</span>=<span class="string">&quot;0px&quot;</span> <span class="attr">android:layout_marginRight</span>=<span class="string">&quot;0dip&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>##5. 添加铃声、修改低电量、截屏等UI声音、禁用音量调节声##</p><p>铃声包：<a href="http://pan.baidu.com/s/1eQfHqAQ">http://pan.baidu.com/s/1eQfHqAQ</a><br>解压替换<code>/System/Media/</code></p><p>##6. 相机声音开关、浏览器谷歌搜索 ##<br><code>/System/csc/others.xml</code><br>添加 <code>ShutterSoundMenu</code>项为 <code>True</code><br>谷歌搜索记不住了，看着英文改就好，很简单的。<br>或使用 <code>CSC Feature Expert</code><br>地址：<a href="http://pan.baidu.com/s/1jGrewUa">http://pan.baidu.com/s/1jGrewUa</a> 密码：m5ui</p><p>##7. 状态栏网速 ##<br>参考这个教程 <a href="http://forum.xda-developers.com/android/general/mod-status-bar-network-traffic-separate-t3024878">http://forum.xda-developers.com/android/general/mod-status-bar-network-traffic-separate-t3024878</a>  </p><p>首先 deodex <code>SystemUI</code> 和 <code>SecSettings</code> 两个系统 apk。<br>下载 <a href="http://pan.baidu.com/s/1dDpSC1N">http://pan.baidu.com/s/1dDpSC1N</a> 这里的文件包。</p><h3><span id="7-1-systemui">7.1 SystemUI</span><a href="#7-1-systemui" class="header-anchor">#</a></h3><p>首先将压缩包里的 smali 文件和 png 图放到反编译后相应的路径下。<br>打开压缩包里的 values 文件夹，将其中 xml 文件的内容添加到反编译后相应文件中。<br>打开 <code>layout/status_bar.xml</code> 文件添加以下内容：  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.android.systemui.statusbar.policy.NetworkTraffic</span> <span class="attr">android:id</span>=<span class="string">&quot;@id/networkTraffic&quot;</span> <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span> <span class="attr">android:layout_height</span>=<span class="string">&quot;fill_parent&quot;</span> <span class="attr">android:singleLine</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>编译 SystemUI 再反编译，打开 <code>res/values/public.xml</code>，再打开 <code>smali/com/android/systemui/statusbar/policy/NetworkTraffic.smali</code> 搜索以下 ID 并用 xml 文件中的值替换 smali 文件中的对应值。压缩包内有相应文件。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x7f0c00c9</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;dimen&quot; <span class="type">name</span>=&quot;net_traffic_single_text_size&quot;</span><br><span class="line"><span class="number">0x7f0c00ca</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;dimen&quot; <span class="type">name</span>=&quot;net_traffic_multi_text_size&quot;</span><br><span class="line"><span class="number">0x7f02042a</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;drawable&quot; <span class="type">name</span>=&quot;stat_sys_network_traffic_updown&quot;</span><br><span class="line"><span class="number">0x7f020429</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;drawable&quot; <span class="type">name</span>=&quot;stat_sys_network_traffic_up&quot;</span><br><span class="line"><span class="number">0x7f020428</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;drawable&quot; <span class="type">name</span>=&quot;stat_sys_network_traffic_down&quot;</span><br></pre></td></tr></table></figure><p>完成后编译之，替换 resources 文件，不多说。</p><p>###7.2 SecSettings ###<br>基本步骤同上，再次反编译后替换如下 smali 中相应 ID：<br><code>NetworkTraffic.smali</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x7f0e000f</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;integer&quot; <span class="type">name</span>=&quot;maskUp&quot;</span><br><span class="line"><span class="number">0x7f0e0010</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;integer&quot; <span class="type">name</span>=&quot;maskDown&quot;</span><br><span class="line"><span class="number">0x7f0e0011</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;integer&quot; <span class="type">name</span>=&quot;maskUnit&quot;</span><br><span class="line"><span class="number">0x7f0e0012</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;integer&quot; <span class="type">name</span>=&quot;maskPeriod&quot;</span><br><span class="line"><span class="number">0x7f09188a</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;string&quot; <span class="type">name</span>=&quot;network_traffic_color_reset&quot;</span><br><span class="line"><span class="number">0x7f09188b</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;string&quot; <span class="type">name</span>=&quot;network_traffic_color_reset_message&quot;</span><br><span class="line"><span class="number">0x7f091677</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;string&quot; <span class="type">name</span>=&quot;ok&quot;</span><br><span class="line"><span class="number">0x7f090198</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;string&quot; <span class="type">name</span>=&quot;cancel&quot;</span><br><span class="line"><span class="number">0x7f0700ef</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;xml&quot; <span class="type">name</span>=&quot;network_traffic&quot;</span><br><span class="line"><span class="number">0x7f09188a</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;string&quot; <span class="type">name</span>=&quot;network_traffic_color_reset&quot;</span><br><span class="line"><span class="number">0x7f02021d</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;drawable&quot; <span class="type">name</span>=&quot;ic_settings_backup&quot;</span><br></pre></td></tr></table></figure><p><code>SeekBarPreference.smali</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x7f0b0696</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;id&quot; <span class="type">name</span>=&quot;seekBarPrefBarContainer&quot;</span><br><span class="line"><span class="number">0x7f040229</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;layout&quot; <span class="type">name</span>=&quot;seek_bar_preference&quot;</span><br><span class="line"><span class="number">0x7f0b0694</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;id&quot; <span class="type">name</span>=&quot;seekBarPrefValue&quot;</span><br><span class="line"><span class="number">0x7f0b0693</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;id&quot; <span class="type">name</span>=&quot;seekBarPrefUnitsRight&quot;</span><br><span class="line"><span class="number">0x7f0b0695</span>    &lt;<span class="built_in">public</span> <span class="keyword">type</span>=&quot;id&quot; <span class="type">name</span>=&quot;seekBarPrefUnitsLeft&quot;</span><br></pre></td></tr></table></figure><p><code>ColorPickerDialog.smali</code></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0x7f04022b    &lt;public <span class="attribute">type</span>=<span class="string">&quot;layout&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;dialog_color_picker”</span></span><br><span class="line"><span class="string">0x7f091920    &lt;public type=&quot;</span>string&quot; <span class="attribute">name</span>=<span class="string">&quot;dialog_color_picker&quot;</span></span><br><span class="line">0x7f0b069f    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;color_picker_view&quot;</span></span><br><span class="line">0x7f0b06a2    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;old_color_panel&quot;</span></span><br><span class="line">0x7f0b069a    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;new_color_panel&quot;</span></span><br><span class="line">0x7f0b069b    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;white_panel&quot;</span></span><br><span class="line">0x7f0b069d    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;black_panel&quot;</span></span><br><span class="line">0x7f0b069c    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;cyan_panel&quot;</span></span><br><span class="line">0x7f0b069e    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;red_panel&quot;</span></span><br><span class="line">0x7f0b06a0    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;green_panel&quot;</span></span><br><span class="line">0x7f0b06a1    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;yellow_panel&quot;</span></span><br><span class="line">0x7f0b06a5    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;hex&quot;</span></span><br><span class="line">0x7f0b06a6    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;enter&quot;</span></span><br><span class="line">0x7f0b069a    &lt;public <span class="attribute">type</span>=<span class="string">&quot;id&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;new_color_panel&quot;</span></span><br></pre></td></tr></table></figure><p>最后将以下代码添加到 <code>res/layout</code>下合适的设置大项中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PreferenceScreen</span> <span class="attr">android:title</span>=<span class="string">&quot;@string/network_traffic_title&quot;</span> <span class="attr">android:key</span>=<span class="string">&quot;network_traffic_state &quot;</span> <span class="attr">android:summary</span>=<span class="string">&quot;@string/network_traffic_summary&quot;</span> <span class="attr">android:fragment</span>=<span class="string">&quot;com.android.settings.temasek.NetworkTraffic&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>编译替换，完工。</p><p>##8. S助手 长按 home 修改 ##</p><p>framework-res/value/integers/config_holdHomeButton - 1</p><p align="right">by Sykie Chen2015.7.10</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> S6 </tag>
            
            <tag> SystemUI </tag>
            
            <tag> 反编译 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>三星 Galaxy S6 保持 knox 0x0 的 root</title>
      <link href="posts/cknp0yiak000q0zo68322d7cc/"/>
      <url>posts/cknp0yiak000q0zo68322d7cc/</url>
      
        <content type="html"><![CDATA[<p>&emsp;&emsp;新入手三星 S6 公开版，按以往的经验 root 时线刷刷入第三方 rocovery 的过程中会导致 knox 0x1 从而失去保修。而且 S6 的国行有 BL 锁，解锁同样会失去保修。<br>&emsp;&emsp;发现 PingPongRoot 可以在不使用线刷动作的前提下获取 root 权限，从而保持 knox 0x0。</p><!-- more ---><p>&emsp;&emsp;XDA 原帖地址：<a href="http://forum.xda-developers.com/galaxy-s6/general/root-pingpongroot-s6-root-tool-t3103016">http://forum.xda-developers.com/galaxy-s6/general/root-pingpongroot-s6-root-tool-t3103016</a><br>&emsp;&emsp;首先下载原帖的附件 pingpongroot_beta6.apk 并安装。（百度网盘：<a href="http://pan.baidu.com/s/1c0ASLhA%EF%BC%89">http://pan.baidu.com/s/1c0ASLhA）</a><br>&emsp;&emsp;安装后启动会提示安装 Super SU，安装后打开 Super SU，不理会报错，然后退出之。重新进入 PingPong Root 点击 Download Data。更新完成后点 Get Root 即可自动完成 root。之后按提示重启手机即获得 root 权限。<br>&emsp;&emsp;但此法仍会导致系统设置内的状态变为“定制”，从而导致 OTA 失效。需要更新时用官方的 Smart Switch 线刷更新系统即可。或通过安装 Xposed 框架（官方不支持三星5.0，但可以通过其他办法刷入）再安装 Wanam Xposed 模块修改设备状态为官方。</p><p>&emsp;&emsp;在 SM-G9200 大陆公开版 G9200ZCU1AOE4 固件测试通过。</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> S6 </tag>
            
            <tag> root </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Landscape 主题修改优化</title>
      <link href="posts/cknp0yibq004c0zo643jv84iw/"/>
      <url>posts/cknp0yibq004c0zo643jv84iw/</url>
      
        <content type="html"><![CDATA[<p>&emsp;&emsp;这几天用 Hexo 搭了个静态博客。觉得默认的 Landscape 主题挺好看，但有些地方很奇怪。别人改好的 Landscape-plus 和 Landscape-f 改动太大，用着不爽，就决定自己从头造个轮子修改一下。</p><p>&emsp;&emsp;基于 <a href="https://github.com/hexojs/hexo-theme-landscape">Landscape</a>，修改添加了部分功能。部分参考了 <a href="https://github.com/howiefh/hexo-theme-landscape-f">Landscape-F</a> 和  <a href="https://github.com/xiangming/landscape-plus">Landscape-plus</a>。<br>&emsp;&emsp;文章参考来源以链接形式放在各节小标题上。有基于原文完善或修改的地方不再另行注明。</p><h2><span id="1-google-jquery-ku-de-you-hua">1. </span><a href="#1-google-jquery-ku-de-you-hua" class="header-anchor">#</a></h2><p><code>layout\_partial\after-footer.ejs</code> 17行</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><span id="more"></span><p>替换为如下代码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://lib.sinaapp.com/js/jquery/2.0.3/jquery-2.0.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">//&lt;![CDATA[</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">if</span> (<span class="keyword">typeof</span> jQuery == <span class="string">&#x27;undefined&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.write(<span class="built_in">unescape</span>(<span class="string">&quot;%3Cscript src=&#x27;/js/jquery-2.0.3.min.js&#x27; type=&#x27;text/javascript&#x27;%3E%3C/script%3E&quot;</span>));</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">// ]]&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里不但将 Google 的 jQuery 替换成了 SAE 的，随后还进行了一个判断，如果获取新浪的 jQuery 失败，则使用本网站自己的 jQuery。为了让这段代码有效，我们要去 jQuery 官方下载合适版本的 jQuery 并将其放到 <code>source\js\ </code> 目录下，命名为 <code>jquery-2.0.3.min.js</code>。<br>还有一点需要特别注意，那就是 jQuery 这个文件在 hexo 生成博客时会被解析，因此一定要将 jQuery 文件开头处的 <code>//@ sourceMappingURL=jquery-2.0.3.min.map</code> 这一行代码删去，否则会导致博客无法生成。</p><h2><span id="2-kua-ping-tai-zi-ti-you-hua">2. </span><a href="#2-kua-ping-tai-zi-ti-you-hua" class="header-anchor">#</a></h2><p>为了能在各个平台上都显示令人满意的字体，我们要修改 CSS 文件中的字体设置，列出多个备选的字体，操作系统会依次尝试，使用系统中已安装的字体。我们要修改的是<code>source\css\_variables.styl</code>这一文件，将其中第22行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">font-sans = <span class="string">&quot;Helvetica Neue&quot;</span>, Helvetica, Arial, sans-serif</span><br></pre></td></tr></table></figure><p>改成如下内容：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">font-sans = Tahoma, <span class="string">&quot;Helvetica Neue&quot;</span>, Helvetica, <span class="string">&quot;Hiragino Sans GB&quot;</span>, <span class="string">&quot;Microsoft YaHei Light&quot;</span>, <span class="string">&quot;Microsoft YaHei&quot;</span>, <span class="string">&quot;Source Han Sans CN&quot;</span>, <span class="string">&quot;WenQuanYi Micro Hei&quot;</span>, sans-serif</span><br></pre></td></tr></table></figure><p>其中 Helvetica、Verdana 是英文字体，前者一般存在于苹果电脑和移动设备上，后者一般存在于 Windows 系统中。冬青黑体（Hiragino Sans GB）、思源黑体（Source Han Sans CN）、文泉驿米黑（WenQuanYi Micro Hei）是中文字体，冬青黑体从 OS X 10.6 开始集成在苹果系统中，文泉驿米黑在Linux的各大发行版中均较为常见，而思源黑体是近期 Google 和 Adobe 合作推出的一款开源字体，很多电脑上也安装了这一字体。这样一来，在绝大部分操作系统中就可以显示美观的字体了。</p><p>##3. <a href="https://www.snip2code.com/Snippet/466525/replace-the-google-link%28css-js%29-to-baidu">代码块等宽字体优化</a> ##</p><p><code>layout\_partial\head.ejs</code> 第31行</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;http://fonts.googleapis.com/css?family=Source+Code+Pro&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>改为</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;http://fonts.useso.com/css?family=Source+Code+Pro&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>##4. 修改添加分享链接 ##<br>###4.1 <a href="http://share.baidu.com/code">百度分享框</a>###</p><p>在百度分享获取代码后，代码可分为两部分。<br>在<code>layout\_partial\article.ejs</code>中第26行插入第一段代码并添加判断条件，若当前页为文章展开页则显示百度分享框，若是缩略则采用原生分享链接，避免百度分享框获取的 URL 错误：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if ((page.layout == &#x27;post&#x27;|| page.layout == &#x27;page&#x27;))&#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bdsharebuttonbox&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- post.permalink %&gt;&quot;</span>&gt;</span>分享到：<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_tsina&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;tsina&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到新浪微博&quot;</span>&gt;</span>新浪微博<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_renren&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;renren&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到人人网&quot;</span>&gt;</span>人人网<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_qzone&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;qzone&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到QQ空间&quot;</span>&gt;</span>QQ空间<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_weixin&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;weixin&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到微信&quot;</span>&gt;</span>微信<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_fbook&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;fbook&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到Facebook&quot;</span>&gt;</span>Facebook<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_twi&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;twi&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到Twitter&quot;</span>&gt;</span>Twitter<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_more&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;more&quot;</span>&gt;</span>其他平台<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; else &#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">data-url</span>=<span class="string">&quot;&lt;%- post.permalink %&gt;&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;&lt;%= post._id %&gt;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;article-share-link&quot;</span>&gt;</span>分享<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>在<code>layout\_partial\after-footer.ejs</code>末尾添加第二部分代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Baidu Share Start ---&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>._bd_share_config=&#123;<span class="string">&quot;common&quot;</span>:&#123;<span class="string">&quot;bdSnsKey&quot;</span>:&#123;<span class="string">&quot;tsina&quot;</span>:<span class="string">&quot;1714312189&quot;</span>&#125;,<span class="string">&quot;bdWbuid&quot;</span>:<span class="number">3904642734</span>,<span class="string">&quot;bdText&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;bdMini&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="string">&quot;bdMiniList&quot;</span>:[<span class="string">&quot;douban&quot;</span>,<span class="string">&quot;kaixin001&quot;</span>,<span class="string">&quot;tieba&quot;</span>,<span class="string">&quot;tsohu&quot;</span>,<span class="string">&quot;sqq&quot;</span>,<span class="string">&quot;youdao&quot;</span>,<span class="string">&quot;qingbiji&quot;</span>,<span class="string">&quot;mail&quot;</span>,<span class="string">&quot;linkedin&quot;</span>,<span class="string">&quot;mshare&quot;</span>,<span class="string">&quot;copy&quot;</span>,<span class="string">&quot;print&quot;</span>],<span class="string">&quot;bdPic&quot;</span>:<span class="string">&quot;http://www.devchen.com/SharePic.png&quot;</span>,<span class="string">&quot;bdStyle&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;bdSize&quot;</span>:<span class="string">&quot;24&quot;</span>&#125;,<span class="string">&quot;share&quot;</span>:&#123;<span class="string">&quot;bdSize&quot;</span>:<span class="number">16</span>&#125;&#125;;<span class="keyword">with</span>(<span class="built_in">document</span>)<span class="number">0</span>[(getElementsByTagName(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>]||body).appendChild(createElement(<span class="string">&#x27;script&#x27;</span>)).src=<span class="string">&#x27;http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=&#x27;</span>+~(-<span class="keyword">new</span> <span class="built_in">Date</span>()/<span class="number">36e5</span>)];</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--- Baidu Share End ---&gt;</span></span><br></pre></td></tr></table></figure><p>其中<code>1714312189</code>为我申请的微博开放平台的 App Key，申请后分享可以显示尾巴。<code>3904642734</code>是我的微博 ID，作用是在文本框里自动艾特我的微博。<br>注意保存时将编码改为 UTF-8，否则会乱码。</p><h3><span id="4-2-yuan-sheng-fen-xiang-de-xiu-gai">4.2 </span><a href="#4-2-yuan-sheng-fen-xiang-de-xiu-gai" class="header-anchor">#</a></h3><p>在 <code>source\js\script.js</code> 中，57行 <code>&#39;&lt;div class=&quot;article-share-links&quot;&gt;&#39;</code>,，下面的四个链接就是 Facebook 等社交网站的分享链接。将其替换或添加如下代码，即可实现分享到国内社交网站：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://service.weibo.com/share/share.php?appkey=1714312189&amp;pic=http%3A%2F%2Fwww.devchen.com%2FSharePic.png&amp;ralateUid=3904642734&amp;searchPic=true&amp;url=&#x27; + encodedUrl + &#x27;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;article-share-sina&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">title</span>=<span class="string">&quot;微博&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;,</span><br><span class="line">&#x27;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://share.renren.com/share/buttonshare.do?link=&#x27; + encodedUrl + &#x27;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;article-share-renren&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">title</span>=<span class="string">&quot;人人&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;,</span><br><span class="line">&#x27;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=&#x27; + encodedUrl + &#x27;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;article-share-qq&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">title</span>=<span class="string">&quot;QQ空间&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;,</span><br><span class="line">&#x27;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://qr.liantu.com/api.php?text=&#x27; + encodedUrl + &#x27;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;article-share-wechat&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">title</span>=<span class="string">&quot;微信&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;,</span><br></pre></td></tr></table></figure><p>注意，微博中<code>“3904642734”</code>是我的微博ID，作用是在文本框里自动艾特我的微博。<br>微信分享中 <code>http://qr.liantu.com/api.php?text=</code> 这个地址是 <a href="http://www.liantu.com/pingtai/">联图网</a> 提供的二维码 API ，用微信扫描后分享。</p><p>同时，还需要替换图标。本主题使用 Font Awesome 来显示图标，但内置的 Font Awesome 版本较旧，无法显示 QQ、腾讯微博等图标，所以，需要下载最新版 <a href="http://fortawesome.github.io/Font-Awesome/">Font Awesome</a>，替换掉 <code>source\css\fonts</code> 中相关文件，并在<code> source\css\_variables.styl</code> 中27行的 <code>font-icon-version</code> 修改为最新的 Font Awesome 版本号。</p><p>然后，在 <code>source\css\_partial\article.styl</code> 中，找到四段以 <code>.article-share-***</code> 开头的代码（273行起），添加如下内容：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">.article-share-sina</span><br><span class="line">  @extend $article-share-link</span><br><span class="line">  &amp;:before</span><br><span class="line">    content: <span class="string">&quot;\f18a&quot;</span></span><br><span class="line">  &amp;:hover</span><br><span class="line">    background: color-sina</span><br><span class="line">    text-shadow: <span class="number">0</span> 1px darken(color-sina, <span class="number">20</span>%)</span><br><span class="line"></span><br><span class="line">.article-share-qq</span><br><span class="line">  @extend $article-share-link</span><br><span class="line">  &amp;:before</span><br><span class="line">    content: <span class="string">&quot;\f1d6&quot;</span></span><br><span class="line">  &amp;:hover</span><br><span class="line">    background: color-qq</span><br><span class="line">    text-shadow: <span class="number">0</span> 1px darken(color-qq, <span class="number">20</span>%)</span><br><span class="line"></span><br><span class="line">.article-share-renren</span><br><span class="line">  @extend $article-share-link</span><br><span class="line">  &amp;:before</span><br><span class="line">    content: <span class="string">&quot;\f18b&quot;</span></span><br><span class="line">  &amp;:hover</span><br><span class="line">    background: color-renren</span><br><span class="line">    text-shadow: <span class="number">0</span> 1px darken(color-renren, <span class="number">20</span>%)</span><br><span class="line"></span><br><span class="line">.article-share-wechat</span><br><span class="line">  @extend $article-share-link</span><br><span class="line">  &amp;:before</span><br><span class="line">    content: <span class="string">&quot;\f1d7&quot;</span></span><br><span class="line">  &amp;:hover</span><br><span class="line">    background: color-wechat</span><br><span class="line">    text-shadow: <span class="number">0</span> 1px darken(color-wechat, <span class="number">20</span>%)</span><br></pre></td></tr></table></figure><p>最后，找到 <code>source\css\_variables.styl</code> 中 <code>Colors</code> 部分（16行），最后四行分别为社交网站图标的背景色，可根据这些网站的主题色修改。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">color-sina = #ff8140</span><br><span class="line">color-qq = #ffcc33</span><br><span class="line">color-renren = #227dc5</span><br><span class="line">color-wechat = #44b549</span><br></pre></td></tr></table></figure><p>##5. <a href="http://starsky.gitcafe.io/2015/05/05/Hexo%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BC%98%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89/">安装 RSS 和 sitemap 插件</a>##</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-feed --save</span><br><span class="line">$ npm install hexo-generator-sitemap --save</span><br></pre></td></tr></table></figure><p>修改 <code>hexo\_config.yml</code> 站点配置，添加：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">Plugins:</span><br><span class="line">  hexo-generator-feed</span><br><span class="line">  hexo-generator-sitemap</span><br><span class="line"></span><br><span class="line">#Feed Atom</span><br><span class="line">feed:</span><br><span class="line">  type: atom</span><br><span class="line">  path: atom.xml</span><br><span class="line">  limit: 20</span><br><span class="line"></span><br><span class="line">#sitemap</span><br><span class="line">sitemap:</span><br><span class="line">  path: sitemap.xml</span><br></pre></td></tr></table></figure><p>然后注意再修改<code>_config.yml</code>主题配置：<br><code>menu:</code>里添加网站地图:<code> /sitemap.xml</code><br>下面也添加<code>rss: /atom.xml</code>（如果有就不用添加了）。</p><p>部署后就能看到“首页”那一栏多了个“网站地图”，点击后有内容且第一行为<br><code>This XML file does not appear to have any style information associated with it. The document tree is shown below.</code><br>就说明成功了。<br>RSS 也是一样。</p><p>##6. 卡片增加阴影 ##<br><code>source/css/_partial/header.styl</code>第5行添加：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-webkit-box-shadow: 2px 4px 5px rgba(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">0.2</span>)</span><br><span class="line">box-shadow: 2px 4px 5px rgba(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure><p>##7. 坑：试图将侧栏放到左面 ##<br>在<code>config.yml</code>中可以配置 Sidebar 为 left。但如此配置后页面在移动端（窄屏）下会错位，文章卡片跑到屏幕外面了。经文件比对后发现修改了该选项仅使<code>css\style.css</code>中190行处添加了 right 从右向左的布局。该布局虽使文章列与侧栏列交换，但窄屏时因为右对齐所以左边界会超出屏幕。尝试将 index.html 中两栏位置互换，错位问题解决，但窄屏下侧栏在文章上方。</p><p>遂弃坑。</p><p>##8. 补救：将文章卡片页面宽度缩窄 ##<br>之所以想将侧栏放到左面是因为屏宽超过1024时若文章换行较多中部会很空。于是可以限制文章页面宽度。<br>在<code>source\css\_variables.styl</code>中将47行<code>main-column</code>的值由默认的9改为8，侧栏宽度由3改为2.5。</p><p>##9. <a href="http://blog.sunnyxx.com/2014/03/07/hexo_customize/">代码块修改</a> ##<br><code>source\css\_partial\highlight.styl</code> 17行改为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">margin: auto</span><br></pre></td></tr></table></figure><p>使代码块不再左右撑开<br>22行添加</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">border-radius: 8px</span><br></pre></td></tr></table></figure><p>圆角。</p><p>##10. 页尾版权信息修改 ##<br>原生的好丑啊！<br><code>layout\_partial\footer.ejs</code><br>添加一个表格，实现分散对齐。添加了网站地图等链接。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;footer-info&quot;</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left&quot;</span>&gt;</span></span><br><span class="line">            Copyright <span class="symbol">&amp;copy;</span> 2014-&lt;%= date(new Date(), &#x27;YYYY&#x27;) %&gt; &lt;%= config.author || config.title %&gt; <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span></span><br><span class="line">            Powered by <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://hexo.io/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>Hexo<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            Theme <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/sykiechen/hexo-theme-hic17&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>HiC17<span class="tag">&lt;/<span class="name">a</span>&gt;</span> by Sykie Chen <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span></span><br><span class="line">            Hosted on <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://gitcafe.com/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>Git Cafe<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:right&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;font-family: FontAwesome;font-size: 20px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://weibo.com/3904642734&quot;</span> <span class="attr">title</span>=<span class="string">&quot;微博&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61834;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.renren.com/287137027&quot;</span> <span class="attr">title</span>=<span class="string">&quot;人人&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61835;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://user.qzone.qq.com/525969441&quot;</span> <span class="attr">title</span>=<span class="string">&quot;QQ空间&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61910;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.facebook.com/sykiechencixi&quot;</span> <span class="attr">title</span>=<span class="string">&quot;Facebook&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#62000;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://twitter.com/HKEY_C17&quot;</span> <span class="attr">title</span>=<span class="string">&quot;twitter&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61593;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.linkedin.com/in/sykiechen&quot;</span> <span class="attr">title</span>=<span class="string">&quot;LinkedIn&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61665;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/sykiechen&quot;</span> <span class="attr">title</span>=<span class="string">&quot;GitHub&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61595;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://plus.google.com/118157846818083514683&quot;</span> <span class="attr">title</span>=<span class="string">&quot;Google+&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61653;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/sitemap.xml&quot;</span>&gt;</span>网站地图<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/atom.xml&quot;</span>&gt;</span>订阅本站<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;mailto:i@devchen.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>联系博主<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span></span><br><span class="line">            ICP 备案你妹</span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此处使用了 Font Awesome 字体中的图标。官网介绍的使用方法是包含一个 css 文件进去。然而 Landscape 主题已经使用过该字体，所以该 css 文件的内容应已包含在 style.css 内。故将 html a 标签的 font 指定为该字体，内容处填写<del>&amp;#<code>UTF编码的十进制值</code>; 可用计算器将官网给出的十六进制 UTF 区位码转换为十进制。</del> &amp;#x<code>UTF十六进制值</code>;。</p><p>##11. <a href="http://howiefh.github.io/2014/04/20/hexo-optimize-and-my-theme-landscape-f/">多说评论框</a> ##</p><p>在<code>layout\_partial\article.ejs</code>中将中部 dis 评论按钮代码替换为：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (post.comments)&#123; %&gt;</span><br><span class="line">  &lt;a href=<span class="string">&quot;&lt;%- post.permalink %&gt;#ds-thread&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ds-thread-count article-comment-link&quot;</span> data-thread-key=<span class="string">&quot;&lt;%- post.path%&gt;&quot;</span>&gt;评论&lt;/a&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>底部评论框替换为：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (!index &amp;&amp; post.comments)&#123; %&gt;</span><br><span class="line">&lt;section id=<span class="string">&quot;comments&quot;</span>&gt;</span><br><span class="line">&lt;!-- 多说评论框 start --&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;ds-thread&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ds-thread&quot;</span> data-thread-key=<span class="string">&quot;&lt;%= post.path%&gt;&quot;</span> data-title=<span class="string">&quot;&lt;%= post.title %&gt;&quot;</span> data-url=<span class="string">&quot;&lt;%= post.permalink %&gt;&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;!-- 多说评论框 end --&gt;</span><br><span class="line">&lt;/section&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p><code>layout\_partial\after-footer.ejs</code>中 dis 评论框 js 替换为从多说获得的代码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> duoshuoQuery = &#123;<span class="attr">short_name</span>:<span class="string">&quot;hkeyc17&quot;</span>&#125;;</span></span><br><span class="line"><span class="javascript">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> ds = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span></span><br><span class="line"><span class="javascript">ds.type = <span class="string">&#x27;text/javascript&#x27;</span>;ds.async = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">ds.src = (<span class="built_in">document</span>.location.protocol == <span class="string">&#x27;https:&#x27;</span> ? <span class="string">&#x27;https:&#x27;</span> : <span class="string">&#x27;http:&#x27;</span>) + <span class="string">&#x27;//static.duoshuo.com/embed.js&#x27;</span>;</span></span><br><span class="line"><span class="javascript">ds.charset = <span class="string">&#x27;UTF-8&#x27;</span>;</span></span><br><span class="line"><span class="javascript">(<span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>] </span></span><br><span class="line"><span class="javascript"> || <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>]).appendChild(ds);</span></span><br><span class="line">    &#125;)();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 多说公共JS代码 end --&gt;</span></span><br></pre></td></tr></table></figure><p>##12. <a href="http://kuangqi.me/tricks/add-weibo-show-in-hexo/">侧栏微博框</a> ##</p><p>登录<a href="http://app.weibo.com/tool/weiboshow">新浪微博开放平台</a>来获取微博秀的代码。然后新建<code>themes/landscape/layout/_widget/weibo.ejs</code>这个文件，将刚刚获取到的代码添加到这个文件中。最后编辑<code>themes/landscape/_config.yml</code>，在<code>widgets:</code>标签后面的适当位置添加<code>- weibo</code>。这样微博秀应该就可以显示在你的博客上了。<br>可以在该文件前后加入条件<br><code>&lt;% if (is_home())&#123; %&gt;</code><br><code>&lt;% &#125; %&gt;</code><br>来限制该挂件仅在主页显示。</p><p>上述方法添加的微博秀没有标题文字，也不像landscape的其他widget那样具有圆角矩形、带内阴影的边框，所以获取微博代码时就要进行一些设置，为了将微博秀“嵌入”到 widget 中，我们要关掉各种边框和标题栏。更重要的是，我们要将微博秀的背景色设置成与主题一致。<br>在ejs前后加入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget-wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;widget-title&quot;</span>&gt;</span>Weibo<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>和</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时外框带有一个<code>padding</code>值，使得微博秀显示在其中小了一圈，我们希望将微博秀贴边显示。这个padding值正是由<code>widget</code>这个 class 的 CSS 设定的。<br>所以在第三行的 div 中指定 padding 值覆盖 css 中的设定。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding: 0px&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>##13. 侧栏 Archive 组件修改 ##<br>该组件列出所有有日志的月份索引，但月在前，与国内习惯不同。且当日志较多时可能会很长。故修改日期格式并限制长度。<br>注意，该修改涉及 Hexo 源代码,是插件目录下 helper 中的一部分，而不仅是本主题的代码。<br><code>\node_modules\hexo\lib\plugins\helper\list_archives.js</code><br>23行，日期格式，由<code>MMMM YYYY</code>改为<code>YYYY - MM</code>。</p><p>将70行起的 if 区块代码改为：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">result += <span class="string">&#x27;&lt;ul class=&quot;&#x27;</span> + className + <span class="string">&#x27;-list&quot;&gt;&#x27;</span>;</span><br><span class="line">len = data.length &lt; <span class="number">10</span> ? data.length : <span class="number">9</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">  item = data[i];</span><br><span class="line"></span><br><span class="line">  result += <span class="string">&#x27;&lt;li class=&quot;&#x27;</span> + className + <span class="string">&#x27;-list-item&quot;&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  result += <span class="string">&#x27;&lt;a class=&quot;&#x27;</span> + className + <span class="string">&#x27;-list-link&quot; href=&quot;&#x27;</span> + link(item) + <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">  result += transform ? transform(item.name) : item.name;</span><br><span class="line">  result += <span class="string">&#x27;&lt;/a&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (showCount)&#123;</span><br><span class="line">    result += <span class="string">&#x27;&lt;span class=&quot;&#x27;</span> + className + <span class="string">&#x27;-list-count&quot;&gt;&#x27;</span> + item.count + <span class="string">&#x27;&lt;/span&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  result += <span class="string">&#x27;&lt;/li&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (data.length &gt; <span class="number">9</span>) result += <span class="string">&#x27;&lt;br&gt;&lt;a href=&quot;&#x27;</span> + self.url_for(archiveDir) + <span class="string">&#x27;&quot;&gt;查看更多...&lt;/a&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">result += <span class="string">&#x27;&lt;/ul&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>##14. 搜索改为 <a href="http://tinysou.com/">Tinysou</a> ##<br>先去官网创建个引擎，然后在“爬虫”那把自己的域名添加进去。<br>新建个<code>tinysou.ejs</code>文件，把提供的代码粘贴进去，保存后放到<code>layout\_partial</code>目录下。</p><p><code>layout\_partial\after-footer.ejs</code>,在最后一行加入<code>&lt;%- partial(&#39;tinysou&#39;) %&gt;</code><br>修改搜索框涉及 Helper。<br><code>node_modules\hexo\lib\plugins\helper\search_form.js</code><br>12行起改为：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&#x27;&lt;form class=&quot;&#x27;</span> + className + <span class="string">&#x27;&quot;&gt;&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;&lt;input type=&quot;input&quot; id=&quot;ts-search-input&quot; name=&quot;q&quot; results=&quot;0&quot; class=&quot;&#x27;</span> + className + <span class="string">&#x27;-input&quot;&#x27;</span> + (text ? <span class="string">&#x27; placeholder=&quot;&#x27;</span> + text + <span class="string">&#x27;&quot;&#x27;</span> : <span class="string">&#x27;&#x27;</span>) + <span class="string">&#x27;&gt;&#x27;</span> +</span><br><span class="line">  (button ? <span class="string">&#x27;&lt;button type=&quot;submit&quot; class=&quot;&#x27;</span> + className + <span class="string">&#x27;-submit&quot;&gt;&#x27;</span> + (<span class="keyword">typeof</span> button === <span class="string">&#x27;string&#x27;</span> ? button : text) + <span class="string">&#x27;&lt;/button&gt;&#x27;</span> : <span class="string">&#x27;&#x27;</span>) +</span><br><span class="line">  <span class="string">&#x27;&lt;/form&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>##15. 头部加入社交入口 ##<br><code>layout\_partial\header.ejs</code> 22 行加入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://weibo.com/3904642734&quot;</span> <span class="attr">title</span>=<span class="string">&quot;微博&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61834;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://www.renren.com/287137027&quot;</span> <span class="attr">title</span>=<span class="string">&quot;人人&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61835;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://user.qzone.qq.com/525969441&quot;</span> <span class="attr">title</span>=<span class="string">&quot;QQ空间&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61910;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.facebook.com/sykiechencixi&quot;</span> <span class="attr">title</span>=<span class="string">&quot;Facebook&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#62000;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://twitter.com/HKEY_C17&quot;</span> <span class="attr">title</span>=<span class="string">&quot;twitter&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61593;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://www.linkedin.com/in/sykiechen&quot;</span> <span class="attr">title</span>=<span class="string">&quot;LinkedIn&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61665;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/sykiechen&quot;</span> <span class="attr">title</span>=<span class="string">&quot;GitHub&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61595;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://plus.google.com/118157846818083514683&quot;</span> <span class="attr">title</span>=<span class="string">&quot;Google+&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="symbol">&amp;#61653;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>##16. <a href="http://howiefh.github.io/2014/04/20/hexo-optimize-and-my-theme-landscape-f/">关于、友链</a> ##<br>添加了<code>links.ejs</code>、<code>about_me.ejs</code>、<code>about_me.styl</code>并在<code>style.styl</code>中添加相关引用。</p><p>##17. <a href="http://howiefh.github.io/2014/04/20/hexo-optimize-and-my-theme-landscape-f/">返回顶部</a></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">modified:   layout<span class="regexp">/_partial/</span>after-footer.ejs</span><br><span class="line">modified:   <span class="keyword">source</span><span class="regexp">/css/</span>_variables.styl</span><br><span class="line">modified:   <span class="keyword">source</span><span class="regexp">/css/</span>style.styl</span><br><span class="line">add layout<span class="regexp">/_partial/</span>bottomBtn.ejs</span><br><span class="line">add <span class="keyword">source</span><span class="regexp">/css/</span>_partial/bottombtn.styl</span><br><span class="line">add <span class="keyword">source</span><span class="regexp">/js/g</span>otop.js</span><br></pre></td></tr></table></figure><p>##18. <a href="http://starsky.gitcafe.io/2015/05/06/%E4%B8%BAHexo%E5%8D%9A%E6%96%87%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95/">文章目录</a>##</p><p><code>layout\_partial\article.ejs</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;% &#125; <span class="keyword">else</span> &#123; %&gt;</span><br><span class="line">    &lt;!-- Table <span class="keyword">of</span> Contents --&gt;</span><br><span class="line">    &lt;% <span class="keyword">if</span> (!index &amp;&amp; post.toc)&#123; %&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;toc&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;toc-article&quot;</span>&gt;</span><br><span class="line">            &lt;strong <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;toc-title&quot;</span>&gt;文章目录&lt;/strong&gt;</span><br><span class="line">    &lt;%- toc(post.content) %&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    &lt;%- post.content %&gt;</span><br></pre></td></tr></table></figure><p><code>source\css\_partial\article.styl</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*toc*/</span></span><br><span class="line"><span class="selector-class">.toc-article</span></span><br><span class="line">  <span class="attribute">background</span> <span class="selector-id">#eee</span></span><br><span class="line">  <span class="attribute">border</span> <span class="number">1px</span> solid <span class="selector-id">#bbb</span></span><br><span class="line">  <span class="attribute">border-radius</span> <span class="number">10px</span></span><br><span class="line">  <span class="attribute">margin</span> <span class="number">1.5em</span> <span class="number">0</span> <span class="number">0.3em</span> <span class="number">1.5em</span></span><br><span class="line">  <span class="attribute">padding</span> <span class="number">1.2em</span> <span class="number">1em</span> <span class="number">0</span> <span class="number">1em</span></span><br><span class="line">  <span class="attribute">max-width</span> <span class="number">28%</span></span><br><span class="line"><span class="selector-class">.toc-title</span></span><br><span class="line">  <span class="attribute">font-size</span> <span class="number">120%</span></span><br><span class="line"><span class="selector-id">#toc</span></span><br><span class="line">  <span class="attribute">line-height</span> <span class="number">1em</span></span><br><span class="line">  <span class="attribute">font-size</span> <span class="number">0.9em</span></span><br><span class="line">  <span class="attribute">float</span> <span class="attribute">right</span></span><br><span class="line">  <span class="selector-class">.toc</span></span><br><span class="line">    <span class="attribute">padding</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">margin</span> <span class="number">1em</span></span><br><span class="line">    <span class="attribute">line-height</span> <span class="number">1.8em</span></span><br><span class="line">    <span class="selector-tag">li</span></span><br><span class="line">      <span class="attribute">list-style-type</span> <span class="attribute">none</span></span><br><span class="line">  <span class="selector-class">.toc-child</span> </span><br><span class="line">    <span class="attribute">margin-left</span> <span class="number">1em</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在需要目录的文章 md 中加入参数<code>toc: true</code></p><h2><span id="19-jiang-wen-zhang-shi-jian-fang-zai-biao-ti-xia">19. 将文章时间放在标题下</span><a href="#19-jiang-wen-zhang-shi-jian-fang-zai-biao-ti-xia" class="header-anchor">#</a></h2><p><code>article.ejs</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  &lt;% &#125; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-meta&quot;</span>&gt;</span></span><br><span class="line">  &lt;%- partial(&#x27;post/date&#x27;, &#123;class_name: &#x27;article-date&#x27;, date_format: &#x27;YYYY-M-D ddd  HH:mm&#x27;&#125;) %&gt;</span><br><span class="line">  &lt;%- partial(&#x27;post/category&#x27;) %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-entry&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;articleBody&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>article.styl</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.article-date</span></span><br><span class="line">  <span class="keyword">@extend</span> $block-caption</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">15px</span> <span class="number">0px</span> <span class="number">15px</span></span><br><span class="line">  <span class="attribute">float</span>: left</span><br><span class="line">  a&amp;:<span class="attribute">hover</span></span><br><span class="line">    <span class="attribute">color</span>: color-link</span><br><span class="line">  &amp;:before</span><br><span class="line">    <span class="attribute">font-family</span>: font-icon</span><br><span class="line">    <span class="attribute">color</span>: #ccc</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;\f073&quot;</span></span><br><span class="line"></span><br><span class="line">.article-category</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">15px</span> <span class="number">0px</span> <span class="number">8px</span></span><br><span class="line">  <span class="attribute">float</span>: left</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1em</span></span><br><span class="line">  <span class="attribute">color</span>: #ccc</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">0</span> <span class="number">1px</span> #fff</span><br><span class="line">  &amp;:before</span><br><span class="line">    <span class="attribute">font-family</span>: font-icon</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;\f0c6&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.article-date</span></span><br><span class="line">  <span class="keyword">@extend</span> $block-caption</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">15px</span> <span class="number">0px</span> <span class="number">20px</span></span><br><span class="line">  <span class="attribute">float</span>: left</span><br><span class="line">  a&amp;:<span class="attribute">hover</span></span><br><span class="line">    <span class="attribute">color</span>: color-link</span><br><span class="line">  &amp;:before</span><br><span class="line">    <span class="attribute">font-family</span>: font-icon</span><br><span class="line">    <span class="attribute">color</span>: #ccc</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;\f073&quot;</span></span><br><span class="line"></span><br><span class="line">.article-category</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">15px</span> <span class="number">0px</span> <span class="number">8px</span></span><br><span class="line">  <span class="attribute">float</span>: left</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1em</span></span><br><span class="line">  <span class="attribute">color</span>: #ccc</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">0</span> <span class="number">1px</span> #fff</span><br><span class="line">  &amp;:before</span><br><span class="line">    <span class="attribute">font-family</span>: font-icon</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;\f0c6&quot;</span></span><br></pre></td></tr></table></figure><h2><span id="20-zai-mou-xie-tu-pian-shang-jin-yong-fancybox">20. </span><a href="#20-zai-mou-xie-tu-pian-shang-jin-yong-fancybox" class="header-anchor">#</a></h2><p>有些情况下希望某些图片不使用 fancybox 的弹出效果，如关于页面中的网站小图标，在 hexo 中可以这样实现：</p><p><code>/source/js/script.js</code>,找到：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Caption</span></span><br><span class="line">  $(<span class="string">&#x27;.article-entry&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    $(<span class="built_in">this</span>).find(<span class="string">&#x27;img&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> ($(<span class="built_in">this</span>).parent().hasClass(<span class="string">&#x27;fancybox&#x27;</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> alt = <span class="built_in">this</span>.alt;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (alt) $(<span class="built_in">this</span>).after(<span class="string">&#x27;&lt;span class=&quot;caption&quot;&gt;&#x27;</span> + alt + <span class="string">&#x27;&lt;/span&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      $(<span class="built_in">this</span>).wrap(<span class="string">&#x27;&lt;a href=&quot;&#x27;</span> + <span class="built_in">this</span>.src + <span class="string">&#x27;&quot; title=&quot;&#x27;</span> + alt + <span class="string">&#x27;&quot; class=&quot;fancybox&quot;&gt;&lt;/a&gt;&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="built_in">this</span>).find(<span class="string">&#x27;.fancybox&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      $(<span class="built_in">this</span>).attr(<span class="string">&#x27;rel&#x27;</span>, <span class="string">&#x27;article&#x27;</span> + i);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ($.fancybox)&#123;</span><br><span class="line">    $(<span class="string">&#x27;.fancybox&#x27;</span>).fancybox();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>在 <code>if ($(this).parent().hasClass(&#39;fancybox&#39;)) return;</code> 下插入 <code>if ($(this).hasClass(&#39;nofancybox&#39;)) return;</code> 意思为如果遇到 nofancybox 类则跳过，这样在不需要 fancybox 显示 img 标签上的 class 改为 nofancybox 就可以禁用 fancybox 了。</p><h2><span id="hou-ji">后记</span><a href="#hou-ji" class="header-anchor">#</a></h2><p>&emsp;&emsp;终于造好了轮子= = 整个人都萌了许多<br>&emsp;&emsp;bug 在所难免，本项目 GitHub 主页：<br><a href="https://github.com/sykiechen/hexo-theme-hic17">https://github.com/sykiechen/hexo-theme-hic17</a><br>&emsp;&emsp;（我知道，没人会去看的=。=）<br>&emsp;&emsp;但我还是觉得我萌了好多！<img src="http://www.devchen.com/css/images/tavatar.png"></p><p align="right">by Sykie Chen2015.5.23</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> Hexo </tag>
            
            <tag> Landscape </tag>
            
            <tag> 主题 </tag>
            
            <tag> 博客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微博小尾巴审核通过啦</title>
      <link href="posts/cknp0yian000u0zo6evuie6c0/"/>
      <url>posts/cknp0yian000u0zo6evuie6c0/</url>
      
        <content type="html"><![CDATA[<p>微博小尾巴的审核通过啦=。=</p><p><img src="/blogimg/weibo-tail-passed/1.png"><br>以后可以愉快地装X了哈哈哈哈哈</p><!-- more ---><p>另外在 GitCafe Pages 上又另弄了个图床，绑在二级域名上，迁移起来应该很方便。<br>摸摸大！我爱这个世界！</p>]]></content>
      
      
      <categories>
          
          <category> 小技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微博 </tag>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
