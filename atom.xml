<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>码渣十七</title>
  <icon>https://www.coder17.com/images/favicon-32x32.png</icon>
  <subtitle>雑魚ーダーの雑魚メモ</subtitle>
  <link href="https://www.coder17.com/atom.xml" rel="self"/>
  
  <link href="https://www.coder17.com/"/>
  <updated>2021-02-21T11:48:00.000Z</updated>
  <id>https://www.coder17.com/</id>
  
  <author>
    <name>東城十七</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>下载 m3u8 推流</title>
    <link href="https://www.coder17.com/posts/m3u8-stream-download/"/>
    <id>https://www.coder17.com/posts/m3u8-stream-download/</id>
    <published>2021-02-21T11:48:00.000Z</published>
    <updated>2021-02-21T11:48:00.000Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>在浏览器 Network 中查找 m3u8</p><p> <img src= "/images/loading.gif" data-lazy-src="/blogimg/%E4%B8%8B%E8%BD%BD%20m3u8%20%E6%8E%A8%E6%B5%81/image-20210221204910267.png" alt="image-20210221204910267"></p></li><li><p>如果是上图所示嵌套，逐级打开对应 m3u8 文件，直到出现 ts 文件列表和密钥</p><p> <img src= "/images/loading.gif" data-lazy-src="/blogimg/%E4%B8%8B%E8%BD%BD%20m3u8%20%E6%8E%A8%E6%B5%81/image-20210221205009425.png" alt="image-20210221205009425"></p></li><li><p>如果要先下载再合并，则观察 ts 文件 url 规律，使用 curl 批量下载文件</p> <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://what-ever-[<span class="number">1</span>-<span class="number">999</span>].ts</span><br></pre></td></tr></table></figure></li><li><p>将 m3u8 文件下载到同一目录，并替换删除其中 url 前缀</p></li><li><p>按照 URI 参数值下载 m3u8 文件中的密钥 key 文件，应为16字节长度。同时改写 m3u8 文件中 key 路径使其指向此文件</p><p> <img src= "/images/loading.gif" data-lazy-src="/blogimg/%E4%B8%8B%E8%BD%BD%20m3u8%20%E6%8E%A8%E6%B5%81/image-20210221205501863.png" alt="image-20210221205501863"></p></li><li><p>使用 ffmpeg 批量解密合并 ts 文件即可获得 mp4 视频</p> <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -loglevel error -allowed_extensions ALL -i prog-index.m3u8 -c <span class="built_in">copy</span> &quot;output.mkv&quot;</span><br></pre></td></tr></table></figure></li><li><p>如果要直接下载，则不需要下载 ts 文件，直接用 ffmpeg 解密 m3u8 文件</p> <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -loglevel error -protocol_whitelist file,http,https,tcp,tls,crypto -allowed_extensions ALL -i prog-index.m3u8 -c <span class="built_in">copy</span> &quot;output.mkv&quot;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;ol&gt;
&lt;li&gt;&lt;p&gt;在浏览器 Network 中查找 m3u8&lt;/p&gt;
&lt;p&gt; &lt;img src= &quot;/images/loading.gif&quot; data-lazy-src=&quot;/blogimg/%E4%B8%8B%E8%BD%BD%20m3u8%20%E6%8E%A8%E6%B</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="m3u8" scheme="https://www.coder17.com/tags/m3u8/"/>
    
    <category term="推流" scheme="https://www.coder17.com/tags/%E6%8E%A8%E6%B5%81/"/>
    
    <category term="下载" scheme="https://www.coder17.com/tags/%E4%B8%8B%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>Windows 10 USB 图标改变解决</title>
    <link href="https://www.coder17.com/posts/windows-10-usb-icon-fix/"/>
    <id>https://www.coder17.com/posts/windows-10-usb-icon-fix/</id>
    <published>2020-08-23T15:00:00.000Z</published>
    <updated>2020-08-23T15:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Windows 的驱动服务器在 2019 年 11 月左右出现了一次 bug 导致所有的U盘图标均变为机柜，即使使用 <code>autorun.inf</code> 修改磁盘图标也无法生效，且单击弹出磁盘时，所有的设备名均变为 Device。</p><p><img src= "/images/loading.gif" data-lazy-src="/blogimg/Windows%2010%20USB%20%E5%9B%BE%E6%A0%87%E6%94%B9%E5%8F%98%E8%A7%A3%E5%86%B3/20191110175553.png" alt="20191110175553"></p><p>原因是 Windows 会联网获取设备驱动与图标，因此服务器端问题会影响本机驱动。驱动服务器问题后来已经修复，但本机已经下载的 USB 驱动还在，因此问题会残留。解决方案是删除已缓存的驱动程序。</p><ul><li><p>打开 <code>C:\ProgramData\Microsoft\Windows\DeviceMetadataCache\dmrccache\en-us</code> 如果目录下有文件，寻找在其中 <code>DeviceInformation</code> 目录中含有 <code>ico2001.ico</code> 的机柜图标的目录，并删除该目录。</p></li><li><p>重启</p></li><li><p>如果没有恢复，或者上述目录中没有文件，则打开控制面板，设备和打印机，删除最下面的无法识别的 Device</p><p>  <img src= "/images/loading.gif" data-lazy-src="/blogimg/Windows%2010%20USB%20%E5%9B%BE%E6%A0%87%E6%94%B9%E5%8F%98%E8%A7%A3%E5%86%B3/image-20200824195700272.png" alt="image-20200824195700272"></p></li><li><p>重新插拔设备，应该可以恢复。此时查看上述目录，应该已经没有文件存在。弹出磁盘的菜单也应恢复显示设备名。</p><p>  <img src= "/images/loading.gif" data-lazy-src="/blogimg/Windows%2010%20USB%20%E5%9B%BE%E6%A0%87%E6%94%B9%E5%8F%98%E8%A7%A3%E5%86%B3/image-20200824195842372.png" alt="image-20200824195842372">  <img src= "/images/loading.gif" data-lazy-src="/blogimg/Windows%2010%20USB%20%E5%9B%BE%E6%A0%87%E6%94%B9%E5%8F%98%E8%A7%A3%E5%86%B3/image-20200824200746369.png" alt="image-20200824200746369"></p></li></ul><p>参考/图片：<a href="https://noushibou.hatenadiary.jp/entry/2019/11/10/101358">https://noushibou.hatenadiary.jp/entry/2019/11/10/101358</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Windows 的驱动服务器在 2019 年 11 月左右出现了一次 bug 导致所有的U盘图标均变为机柜，即使使用 &lt;code&gt;autorun.inf&lt;/code&gt; 修改磁盘图标也无法生效，且单击弹出磁盘时，所有的设备名均变为 Device。&lt;/p&gt;
&lt;p&gt;&lt;img sr</summary>
      
    
    
    
    <category term="Windows" scheme="https://www.coder17.com/categories/Windows/"/>
    
    
    <category term="图标" scheme="https://www.coder17.com/tags/%E5%9B%BE%E6%A0%87/"/>
    
    <category term="Windows 10" scheme="https://www.coder17.com/tags/Windows-10/"/>
    
  </entry>
  
  <entry>
    <title>Nextcloud 新建用户报错</title>
    <link href="https://www.coder17.com/posts/nextcloud-new-user-error/"/>
    <id>https://www.coder17.com/posts/nextcloud-new-user-error/</id>
    <published>2020-08-12T17:31:00.000Z</published>
    <updated>2020-08-12T17:31:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Nextcloud 新建用户时，日志提示错误：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Call</span> <span class="keyword">to</span> a member <span class="keyword">function</span> getSize() <span class="keyword">on</span> <span class="type">bool</span></span><br></pre></td></tr></table></figure><p>导致用户列表无法显示，且新用户无法登录。</p><p>原因是用户配额和 <code>quota_include_external_storage</code> 设置之间有冲突。</p><p>绕过方案为：</p><ul><li><p>修改<code>/var/www/html/config/config.php</code>：</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">‘quota_include_external_storage’ =&gt; <span class="literal">false</span>,</span><br></pre></td></tr></table></figure></li><li><p>此时用户列表可以显示，删除新建的出错用户</p></li><li><p>重新添加新用户，配额容量无限制</p></li><li><p>以新用户身份登陆一次，确认文件正常</p></li><li><p>将 <code>quota_include_external_storage</code> 改回去</p></li><li><p>根据需求限制新用户配额</p></li></ul><p>此时新用户可正常使用。</p><p>当共享大量文件给新用户时，由于被共享文件也计入用户配额使用，因此可能提示配额超限。</p><p>此外如果共享文件的 owner 曾出现误报存储已满问题时，即使通过修改 <code>quota_include_external_storage</code> 解决，被共享用户在进入共享文件目录时也仍会提示其他用户存储满。暂时无法解决，无实际影响可忽略。</p><p><img src= "/images/loading.gif" data-lazy-src="/blogimg/Nextcloud%20%E6%96%B0%E5%BB%BA%E7%94%A8%E6%88%B7%E6%8A%A5%E9%94%99/image-20200813023129134.png" alt="image-20200813023129134"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Nextcloud 新建用户时，日志提示错误：&lt;/p&gt;
&lt;figure class=&quot;highlight pgsql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;</summary>
      
    
    
    
    <category term="Services" scheme="https://www.coder17.com/categories/Services/"/>
    
    
    <category term="Nextcloud" scheme="https://www.coder17.com/tags/Nextcloud/"/>
    
    <category term="报错" scheme="https://www.coder17.com/tags/%E6%8A%A5%E9%94%99/"/>
    
  </entry>
  
  <entry>
    <title>Nextcloud 误报存储已满</title>
    <link href="https://www.coder17.com/posts/nextcloud-storage-full/"/>
    <id>https://www.coder17.com/posts/nextcloud-storage-full/</id>
    <published>2020-08-06T08:22:00.000Z</published>
    <updated>2020-08-06T08:22:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>在 Nextcloud 数据目录下 mount 其他位置的存储时，会误报存储已满。</p><p>问题原因在于统计文件大小时会将外部存储和被共享文件全部计入，而统计总容量时不计算外部存储和 mount 的其他位置。</p><p>修改<code>/var/www/html/config/config.php</code>，添加参数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">‘quota_include_external_storage’ =&gt; <span class="literal">true</span>,</span><br></pre></td></tr></table></figure><p>并且在用户配置中，将配额改为“无限”以外的具体数值：</p><p><img src= "/images/loading.gif" data-lazy-src="/blogimg/NextCloud%20%E8%AF%AF%E6%8A%A5%E5%AD%98%E5%82%A8%E5%B7%B2%E6%BB%A1/image-20200806172234483.png" alt="image-20200806172234483"></p><p>设置后当前用户不再提示存储满，但如果此用户分享文件给其他用户，则被分享用户访问时仍会提醒文件 owner 的存储满。</p><p>此外，即使 UI 上不提示，但 Nextcloud 内部的判定依然是存储满，因此 File Versioning 会因为空间不足而不工作，目前没有找到解决方法。因此不推荐层叠 mount 方式存储。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在 Nextcloud 数据目录下 mount 其他位置的存储时，会误报存储已满。&lt;/p&gt;
&lt;p&gt;问题原因在于统计文件大小时会将外部存储和被共享文件全部计入，而统计总容量时不计算外部存储和 mount 的其他位置。&lt;/p&gt;
&lt;p&gt;修改&lt;code&gt;/var/www/html/</summary>
      
    
    
    
    <category term="Services" scheme="https://www.coder17.com/categories/Services/"/>
    
    
    <category term="Nextcloud" scheme="https://www.coder17.com/tags/Nextcloud/"/>
    
    <category term="误报" scheme="https://www.coder17.com/tags/%E8%AF%AF%E6%8A%A5/"/>
    
  </entry>
  
  <entry>
    <title>Nextcloud 自动扫描硬盘文件更新</title>
    <link href="https://www.coder17.com/posts/nextcloud-auto-scan/"/>
    <id>https://www.coder17.com/posts/nextcloud-auto-scan/</id>
    <published>2020-08-06T06:18:00.000Z</published>
    <updated>2020-08-06T06:18:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Nextcloud 如果直接在数据目录进行读写文件，Web UI 上不会显示文件的实时更新。解决方案有三种。</p><h2 id="1-手动扫描更新"><a href="#1-手动扫描更新" class="headerlink" title="1. 手动扫描更新"></a>1. 手动扫描更新</h2><p>在命令行使用 <code>php occ files:scan --all</code> 手动扫描。在 docker 中执行需要用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/bash -c <span class="string">&quot;php /var/www/html/occ files:scan --all&quot;</span> -g users www-data</span><br></pre></td></tr></table></figure><p>其中 -g 后的参数依次为分组名和用户名。</p><h2 id="2-修改-config-php-自动扫描"><a href="#2-修改-config-php-自动扫描" class="headerlink" title="2. 修改 config.php 自动扫描"></a>2. 修改 config.php 自动扫描</h2><p>修改<code>/var/www/html/config/config.php</code>，添加参数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;filesystem_check_changes&#x27;</span> =&gt; <span class="literal">true</span>,</span><br></pre></td></tr></table></figure><p>实现自动扫描</p><h2 id="3-使用外部存储"><a href="#3-使用外部存储" class="headerlink" title="3. 使用外部存储"></a>3. 使用外部存储</h2><p>将需要直接读写的目录分离，并使用外部存储功能挂载。缺点是外部存储由插件实现，时常有 bug 出现。</p><p>参考：</p><p><a href="https://help.nextcloud.com/t/folders-and-filesystem-check-changes/8203">https://help.nextcloud.com/t/folders-and-filesystem-check-changes/8203</a></p><p><a href="https://it.ismy.fun/2018/11/12/nextcloud-auto-files-scan/">https://it.ismy.fun/2018/11/12/nextcloud-auto-files-scan/</a></p><p><a href="https://unix.stackexchange.com/questions/372850/how-to-run-command-as-different-user">https://unix.stackexchange.com/questions/372850/how-to-run-command-as-different-user</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Nextcloud 如果直接在数据目录进行读写文件，Web UI 上不会显示文件的实时更新。解决方案有三种。&lt;/p&gt;
&lt;h2 id=&quot;1-手动扫描更新&quot;&gt;&lt;a href=&quot;#1-手动扫描更新&quot; class=&quot;headerlink&quot; title=&quot;1. 手动扫描更新&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="Services" scheme="https://www.coder17.com/categories/Services/"/>
    
    
    <category term="Nextcloud" scheme="https://www.coder17.com/tags/Nextcloud/"/>
    
    <category term="扫描硬盘" scheme="https://www.coder17.com/tags/%E6%89%AB%E6%8F%8F%E7%A1%AC%E7%9B%98/"/>
    
  </entry>
  
  <entry>
    <title>QNAP 普通用户环境变量不生效解决</title>
    <link href="https://www.coder17.com/posts/qnap-env-var/"/>
    <id>https://www.coder17.com/posts/qnap-env-var/</id>
    <published>2020-08-02T14:55:00.000Z</published>
    <updated>2020-08-02T14:55:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>内置 admin 用户的 home 位于 <code>/root</code> ，而新建用户的 home 位于 <code>/share/homes/USERNAME</code>。此目录缺乏各种 rc 文件。导致安装 opkg 等第三方工具时无法自动设置 path。</p><p>解决方案为使用普通用户登录 SSH 并定位到 home，然后把 root 目录里的各种配置文件软链接过来。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ln -s /root/.bash_logout .bash_logout</span><br><span class="line">ln -s /root/.bash_profile .bash_profile</span><br><span class="line">ln -s /root/.bashrc .bashrc</span><br><span class="line">ln -s /root/.profile .profile</span><br></pre></td></tr></table></figure><p>修改后普通用户的 prompt 也会变成 <code>#</code> ，非常迷惑，原因是 PS1 变量在 <code>.profile</code> 中被修改，<code>sudo vim .profile</code> 编辑该文件，注释掉第一行的修改语句即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># export PS1=&#x27;[\w] # &#x27;</span></span><br><span class="line">reset</span><br><span class="line"><span class="built_in">source</span> /opt/etc/profile</span><br></pre></td></tr></table></figure><p>威联通的系统似乎没有考虑过建立普通用户日常使用的问题，默认思维模式都是使用内置 admin 账户完成，软件质量比较一般。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;内置 admin 用户的 home 位于 &lt;code&gt;/root&lt;/code&gt; ，而新建用户的 home 位于 &lt;code&gt;/share/homes/USERNAME&lt;/code&gt;。此目录缺乏各种 rc 文件。导致安装 opkg 等第三方工具时无法自动设置 path。&lt;/p</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="QNAP" scheme="https://www.coder17.com/tags/QNAP/"/>
    
    <category term="环境变量" scheme="https://www.coder17.com/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"/>
    
  </entry>
  
  <entry>
    <title>Docker volume 备份与恢复</title>
    <link href="https://www.coder17.com/posts/docker-volume-backup/"/>
    <id>https://www.coder17.com/posts/docker-volume-backup/</id>
    <published>2020-07-29T10:16:00.000Z</published>
    <updated>2020-07-29T10:16:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://jiajially.gitbooks.io/dockerguide/content/chapter_fastlearn/docker_run/--volumes-from.html">https://jiajially.gitbooks.io/dockerguide/content/chapter_fastlearn/docker_run/--volumes-from.html</a></p><p>使用 –volumes-from 创建一个加载 dbdata 容器卷的容器，并从本地主机挂载当前到容器的 /backup 目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --volumes-from aaa -v $(<span class="built_in">pwd</span>):/backup alpine tar zcvf /backup/aaa.tar.gz /&lt;path&gt;</span><br></pre></td></tr></table></figure><p>volumes-from 创建的容器其挂载的所有数据卷路径均与原容器相同，因此 <code>&lt;path&gt;</code> 改为原容器数据卷的挂载位置即可。</p><p>容器启动后，使用了 tar 命令来将 dbdata 卷备份为本地的 /backup/backup.tar。 如果要恢复数据到一个容器，首先创建一个带有数据卷的目标容器。（或者先创建空数据卷）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -v volume_name:/volume_mount_path --name target alpine /bin/ash</span><br></pre></td></tr></table></figure><p>然后创建另一个容器，挂载 dbdata2 的容器，并使用 untar 解压备份文件到挂载的容器卷中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --volumes-from target -v $(<span class="built_in">pwd</span>):/backup alpine tar zxvf /backup/aaa.tar.gz -C /</span><br></pre></td></tr></table></figure><p>其中 <code>-C /</code> 表示解压路径从根目录开始，从而确保路径和备份时完全对应。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://jiajially.gitbooks.io/dockerguide/content/chapter_fastlearn/docker_run/--volumes-from.html&quot;&gt;https://jiajially.gitbooks.i</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.coder17.com/categories/Linux/"/>
    
    
    <category term="Docker" scheme="https://www.coder17.com/tags/Docker/"/>
    
    <category term="volume" scheme="https://www.coder17.com/tags/volume/"/>
    
    <category term="备份" scheme="https://www.coder17.com/tags/%E5%A4%87%E4%BB%BD/"/>
    
  </entry>
  
  <entry>
    <title>Grav 主题 Granty 5 Helium 部分修复与改造[弃坑]</title>
    <link href="https://www.coder17.com/posts/grav-helium-mod/"/>
    <id>https://www.coder17.com/posts/grav-helium-mod/</id>
    <published>2020-05-17T10:43:00.000Z</published>
    <updated>2020-05-17T10:43:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Header-Owl-Carousel-副标题-Tablet-宽度下错位溢出问题"><a href="#1-Header-Owl-Carousel-副标题-Tablet-宽度下错位溢出问题" class="headerlink" title="1. Header Owl Carousel 副标题 Tablet 宽度下错位溢出问题"></a>1. Header Owl Carousel 副标题 Tablet 宽度下错位溢出问题</h2><p><code>user\data\gantry5\themes\g5_helium\scss\custom.scss</code></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fix header subtitle overflow in tablet view</span></span><br><span class="line"><span class="comment">// user\themes\g5_helium\scss\helium\particles\_owlcarousel.scss:378</span></span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> all <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">59.99rem</span>) <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">48rem</span>)&#123;</span><br><span class="line">    <span class="selector-class">.g-owlcarousel</span> <span class="selector-class">.g-owlcarousel-item-wrapper</span> <span class="selector-class">.g-owlcarousel-item-content-container</span> <span class="selector-class">.g-owlcarousel-item-content-wrapper</span> <span class="selector-class">.g-owlcarousel-item-content</span> &#123;</span><br><span class="line">        <span class="attribute">padding-top</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-Mobile-宽度下菜单栏和-logo-位置错位问题"><a href="#2-Mobile-宽度下菜单栏和-logo-位置错位问题" class="headerlink" title="2. Mobile 宽度下菜单栏和 logo 位置错位问题"></a>2. Mobile 宽度下菜单栏和 logo 位置错位问题</h2><p>导航栏空白太大，将 Navigation 的部分设置 nomarginall 和 nopaddingall 后引起移动端错位，在此修正。</p><p><img src= "/images/loading.gif" data-lazy-src="/blogimg/Grav%20%E4%B8%BB%E9%A2%98%20Granty%205%20Helium%20%E9%83%A8%E7%BD%B2%E4%B8%8E%E6%94%B9%E9%80%A0/image-20200517194323886.png" alt="image-20200517194323886"></p><p><code>user\data\gantry5\themes\g5_helium\scss\custom.scss</code></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fix menu icon position on mobile view</span></span><br><span class="line"><span class="comment">// user\themes\g5_helium\scss\helium\sections\_offcanvas.scss:45</span></span><br><span class="line"><span class="selector-class">.g-offcanvas-toggle</span>&#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0.7rem</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// gix logo position on mobile view</span><br><span class="line">// user\themes\g5_helium\scss\helium\particles\_logo.scss:<span class="number">25</span></span><br><span class="line">@media only all and (max-width: <span class="number">47.99rem</span>)&#123;</span><br><span class="line">    .g-logo &#123;</span><br><span class="line">        margin: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-导航栏滚动固定"><a href="#3-导航栏滚动固定" class="headerlink" title="3. 导航栏滚动固定"></a>3. 导航栏滚动固定</h2><p>使用 <a href="https://www.inspiretheme.com/blog/freebies/42-fixed-sticky-header-atoms-for-gantry-5-freebies">Fixed_Sticky Header Atoms for Gantry 5 (FREEBIES)</a> 实现</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-Header-Owl-Carousel-副标题-Tablet-宽度下错位溢出问题&quot;&gt;&lt;a href=&quot;#1-Header-Owl-Carousel-副标题-Tablet-宽度下错位溢出问题&quot; class=&quot;headerlink&quot; title=&quot;1. Heade</summary>
      
    
    
    
    <category term="Services" scheme="https://www.coder17.com/categories/Services/"/>
    
    
    <category term="Grav" scheme="https://www.coder17.com/tags/Grav/"/>
    
    <category term="Helium" scheme="https://www.coder17.com/tags/Helium/"/>
    
  </entry>
  
  <entry>
    <title>华硕路由修改区域</title>
    <link href="https://www.coder17.com/posts/asus-region-mod/"/>
    <id>https://www.coder17.com/posts/asus-region-mod/</id>
    <published>2020-05-12T02:13:00.000Z</published>
    <updated>2020-05-12T02:13:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>必须安装 Merlin 固件。</p><p>控制国家码的部分在 CFE 不能修改，且 nvram 修改后重启系统/服务即失效。<br>因此加到系统启动和服务启动的脚本即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">touch /jffs/scripts/init-start</span><br><span class="line">ln -s /jffs/scripts/init-start /jffs/scripts/service-event</span><br><span class="line">chmod a+rx /jffs/scripts/*</span><br><span class="line">vi /jffs/scripts/init-start</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">nvram <span class="built_in">unset</span> territory_code</span><br><span class="line">nvram <span class="built_in">set</span> location_code=JP</span><br><span class="line">nvram <span class="built_in">set</span> 0:ccode=JP</span><br><span class="line">nvram <span class="built_in">set</span> 1:ccode=JP</span><br><span class="line">nvram <span class="built_in">set</span> wl0_country_code=JP</span><br><span class="line">nvram <span class="built_in">set</span> wl1_country_code=JP</span><br></pre></td></tr></table></figure><p>并在 web 设置中 <code>Administration -&gt; System</code> 启用用户脚本。<br>其中 AA 为亚洲区，信号功率25，频段不全。需要其他频段时可设为 JP 或 TW。</p><p>然后在 Web 界面中重启路由器。</p><p>改好后语言菜单会解锁全部语言：</p><p><img src= "/images/loading.gif" data-lazy-src="/blogimg/%E5%8D%8E%E7%A1%95%E8%B7%AF%E7%94%B1%E4%BF%AE%E6%94%B9%E5%8C%BA%E5%9F%9F/image-20210421222345051.png" alt="image-20210421222345051"></p><p><a href="https://github.com/RMerl/asuswrt-merlin/wiki/User-scripts">User scripts · RMerl/asuswrt-merlin Wiki · GitHub</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;必须安装 Merlin 固件。&lt;/p&gt;
&lt;p&gt;控制国家码的部分在 CFE 不能修改，且 nvram 修改后重启系统/服务即失效。&lt;br&gt;因此加到系统启动和服务启动的脚本即可。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="华硕" scheme="https://www.coder17.com/tags/%E5%8D%8E%E7%A1%95/"/>
    
    <category term="路由器" scheme="https://www.coder17.com/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
    <category term="Merlin" scheme="https://www.coder17.com/tags/Merlin/"/>
    
  </entry>
  
  <entry>
    <title>废物利用为 Galaxy S6 SM-G9200 刷入可用系统</title>
    <link href="https://www.coder17.com/posts/galaxy-s6-system/"/>
    <id>https://www.coder17.com/posts/galaxy-s6-system/</id>
    <published>2020-04-24T15:00:00.000Z</published>
    <updated>2020-04-24T15:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Galaxy S6 发布于2015年，中国大陆公开版是双卡单4G，初始系统版本 5.0。我将其作为备用机多年来一直使用当年自行修改的旧版 6.0 系统，时过境迁现在已兼容性较差。三星已经发布了7.0版本的系统更新，因此试图更新到最新版本的 offical 系统。但中国版系统阉割严重，且有大量中国毒瘤App，无法直接使用。</p><p>尝试 Odin 刷入港版系统，不管是四件套还是一体包，单刷还是全部，均会验证失败。查阅得知该型号虽然港版和中国（内地，下略）版均标示型号为<code>SM-G9200</code>，但港版机型代号为<code>zerofltezh</code>，中国版为<code>zerofltezc</code>，基带不同，港版不支持中国电信网络，因此无法混刷。</p><p>故底包只能采用中国版官方固件。在此基础上刷入 GApps 使手机可用。</p><h2 id="1-刷入完整系统"><a href="#1-刷入完整系统" class="headerlink" title="1. 刷入完整系统"></a>1. 刷入完整系统</h2><p>使用 <a href="https://samfirmtool.com/"><code>SamFirm</code></a> 下载最新版<code>CHC</code>区域固件四件套：</p><p><img src= "/images/loading.gif" data-lazy-src="/blogimg/%E5%BA%9F%E7%89%A9%E5%88%A9%E7%94%A8%E4%B8%BA%20Galaxy%20S6%20SM-G9200%20%E5%88%B7%E5%85%A5%E5%8F%AF%E7%94%A8%E7%B3%BB%E7%BB%9F/image-20200425054145843.png" alt="image-20200425054145843"></p><p>使用最新版 <code>Odin</code> 刷入手机，重启，确认正常动作。</p><h2 id="2-刷入-CF-Auto-Root"><a href="#2-刷入-CF-Auto-Root" class="headerlink" title="2. 刷入  CF-Auto-Root"></a>2. 刷入  CF-Auto-Root</h2><p>在 <a href="https://desktop.firmware.mobi/">其网站主页</a> 输入型号G9200后，选择 <code>zerofltezc</code> 版本：</p><p><img src= "/images/loading.gif" data-lazy-src="/blogimg/%E5%BA%9F%E7%89%A9%E5%88%A9%E7%94%A8%E4%B8%BA%20Galaxy%20S6%20SM-G9200%20%E5%88%B7%E5%85%A5%E5%8F%AF%E7%94%A8%E7%B3%BB%E7%BB%9F/image-20200425054507054.png" alt="image-20200425054507054"></p><p>点击最新固件，在其下载页面单击 Configure：</p><p><img src= "/images/loading.gif" data-lazy-src="/blogimg/%E5%BA%9F%E7%89%A9%E5%88%A9%E7%94%A8%E4%B8%BA%20Galaxy%20S6%20SM-G9200%20%E5%88%B7%E5%85%A5%E5%8F%AF%E7%94%A8%E7%B3%BB%E7%BB%9F/image-20200425054555517.png" alt="image-20200425054555517"></p><p>在配置选项中，<code>Installation type</code> 选择 <code>Systemless Image</code>，<code>Advanced Encryption Options</code> 中 <code>dm-verify</code> 选择 <code>Remove</code> ，其他保持默认，点击 <code>Generate</code> 生成刷机镜像，可能需要排队，且下载速度较慢。</p><p>下载后使用 Odin 在 AP 中刷入手机，重启，确认正常动作。</p><h2 id="3-刷入-Magisk"><a href="#3-刷入-Magisk" class="headerlink" title="3. 刷入 Magisk"></a>3. 刷入 Magisk</h2><p>SuperSU 作者已经弃坑不再更新，当前使用 <a href="https://github.com/topjohnwu/Magisk"><code>Magisk</code></a> 管理SU权限。但我们目前没有安装 custom recovery，故不使用 zip 包直接安装，而采用 patch 系统镜像并用 Odin 刷入的方式安装。</p><ol><li>在 GitHub Release 页面获取最新的 <code>Magisk Manager</code> 并安装。</li><li>使用 <code>7-zip</code> 打开 rom 四件套中的 AP 文件，解压其中 <code>boot.img</code> 并复制到手机中。</li><li>运行 <code>Magisk Manager</code> ，点击安装 Magisk，选择 Patch 镜像，并继续在文件浏览中选择刚才提取的 <code>boot.img</code>。（注：根据官方文档，可以选择 Patch boot 或者 recovery，但测试 recovery 不成功，故此处采用 boot）</li><li>将 patch 过后的 IMG 文件复制回电脑，更名为 <code>boot.img</code>，并使用 <code>7-zip</code> 等压缩软件打包为 tar 格式。</li><li>在 Odin 的 AP 中选中刚才打包的 tar 包，刷入手机。</li><li>重启，进入 <code>Magisk Manager</code> ，选择同意下载安装，再次重启后确认正常动作。</li></ol><h2 id="4-刷入修改版-TWRP-recovery"><a href="#4-刷入修改版-TWRP-recovery" class="headerlink" title="4. 刷入修改版 TWRP recovery"></a>4. 刷入修改版 TWRP recovery</h2><p>TWRP 没有正式提供 G9200 版本的支持。多年前 <a href="https://www.weibo.com/1649111590">Xiao1u</a> 曾提供过修改过的兼容版本 <code>G9200-PC1-TWRP-3.0-PC1-0324.tar</code> ，搜索即可获得，此版本对 7.0 系统的兼容不完美，有可能会导致 bootloop。参考 <a href="https://jtechboard.blogspot.com/2017/09/galaxy-s6-sm-g9200-china-model.html">J Tech board 的解决方案</a>，在确认 <code>dm-verify</code> 已关闭后，使用 Odin 刷入该文件。刷入时取消 Odin 中 Auto Reboot 的勾选。刷完后使用 Vol+ Home Pow 三键进入 recovery，什么都不做直接选择重启到系统，询问是否阻止系统还原 Recovery 时选择忽略。确认依然能正常进入系统。</p><h2 id="5-删除自带的中国-App-和字体等"><a href="#5-删除自带的中国-App-和字体等" class="headerlink" title="5. 删除自带的中国 App 和字体等"></a>5. 删除自带的中国 App 和字体等</h2><p>如果不删除，后面刷入 GApps 可能导致系统空间不足。即使删除后仍要使用，可以事后重新安装到用户空间。</p><p>安装 <a href="https://apkpure.com/jp/system-app-remover-root-needed/com.jumobile.manager.systemapp">System App Remover</a> 查看想要移除的内置应用，长按可以获得该应用的路径。使用 <a href="https://apkpure.com/solid-explorer-file-manager/pl.solidexplorer2">Solid Explorer</a> 定位并删除文件。</p><h2 id="6-刷入-Gapps"><a href="#6-刷入-Gapps" class="headerlink" title="6. 刷入 Gapps"></a>6. 刷入 Gapps</h2><p>在 <a href="https://opengapps.org/">OpenGapps</a> 的主页获得 zip 刷机包，传输至手机，重启至 TWRP 后选择刷入。注意此处如果直接刷入 7.0 系统对应的 nano 或者 pico 包，<a href="https://github.com/opengapps/opengapps/issues/724#issuecomment-497997441">会导致系统 WebView 被删除</a>，从而导致 Google 账户无法登录等问题，无法使用。</p><p>解决方案有两个思路，一是安装新的 Chrome WebView 替代被删除的原生 WebView，二是避免原生 WebView 被删除。经测试，即使安装Chrome 也仍然不能恢复该组件正常使用，可能三星对允许使用的 WebView 做了限制，或有其他兼容性问题。避免 WebView 被删除则可以通过<a href="https://github.com/opengapps/opengapps/wiki/Advanced-Features-and-Options">添加配置文件</a> ，或者<a href="https://github.com/opengapps/opengapps/issues/724#issuecomment-498086440">添加 package-overlay 重新编译</a> 等方法。这里使用相对比较简单的<a href="https://github.com/opengapps/opengapps/issues/724#issuecomment-612578593">修改安装脚本</a>方式完成。</p><p>下载 pico 版本 OpenGApps zip 包后，解压提取 <code>install.sh</code> 文件，搜索：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> List of GApps files that should NOT be automatically removed as they are also included <span class="keyword">in</span> (many) ROMs removal_bypass_list</span></span><br></pre></td></tr></table></figure><p>并在其后的空引号内加入 <code>WebViewGoogle</code>，保存退出，将修改后的文件压入 zip 包，重启手机进入 TWRP 刷入即可。</p><p>刷好后清空缓存，进入系统开发者模式，查看 “实装的 WebView” 选项不为空，即可。推荐重启手机，双清后从向导开始重新初始化系统，避免谷歌系列服务出现授权问题。</p><h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><p>避免购买在中国大陆境内售卖的任何具有中国定制 Rom 的电子产品（包括无线耳机等具有中国区定制 Firmware 的产品），并 7x24 连接<strong>全球互联网</strong>，和全球大多数国家和地区的用户保持类似的软件使用习惯，可以避免绝大多数的烦恼。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Galaxy S6 发布于2015年，中国大陆公开版是双卡单4G，初始系统版本 5.0。我将其作为备用机多年来一直使用当年自行修改的旧版 6.0 系统，时过境迁现在已兼容性较差。三星已经发布了7.0版本的系统更新，因此试图更新到最新版本的 offical 系统。但中国版系统</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="Android" scheme="https://www.coder17.com/tags/Android/"/>
    
    <category term="Galaxy S6" scheme="https://www.coder17.com/tags/Galaxy-S6/"/>
    
    <category term="SM-G9200" scheme="https://www.coder17.com/tags/SM-G9200/"/>
    
    <category term="刷机" scheme="https://www.coder17.com/tags/%E5%88%B7%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Linux MAC 地址伪装</title>
    <link href="https://www.coder17.com/posts/linux-mac-faking/"/>
    <id>https://www.coder17.com/posts/linux-mac-faking/</id>
    <published>2020-04-06T09:01:00.000Z</published>
    <updated>2020-04-06T09:01:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://wiki.archlinux.jp/index.php/MAC_%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E5%81%BD%E8%A3%85#.E6.96.B9.E6.B3.95_1:_systemd-networkd">https://wiki.archlinux.jp/index.php/MAC_アドレス偽装#.E6.96.B9.E6.B3.95_1:_systemd-networkd</a></p><p>Tested on Ubuntu 18.04 LTS</p><p>创建系统服务，每次开机时使用 ip link set 修改 mac 地址。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/macspoof@.service</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=MAC Address Change %I</span><br><span class="line"><span class="attr">Wants</span>=network-pre.target</span><br><span class="line"><span class="attr">Before</span>=network-pre.target</span><br><span class="line"><span class="attr">BindsTo</span>=sys-subsystem-net-devices-%i.device</span><br><span class="line"><span class="attr">After</span>=sys-subsystem-net-devices-%i.device</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=<span class="literal">on</span>eshot</span><br><span class="line"><span class="attr">ExecStart</span>=/sbin/ip link set dev %i address <span class="number">90</span>:<span class="number">2</span>b:<span class="number">34</span>:d2:<span class="number">15</span>:<span class="number">25</span></span><br><span class="line"><span class="attr">ExecStart</span>=/sbin/ip link set dev %i up</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> macspoof@eth0.service</span><br></pre></td></tr></table></figure><p>已知问题：有时涉及网络的重启（推测如 docker）会导致失效。此时需要重启服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service macspoof@eno2 restart</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://wiki.archlinux.jp/index.php/MAC_%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E5%81%BD%E8%A3%85#.E6.96.B9.E6.B3.95_1:_systemd-net</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.coder17.com/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://www.coder17.com/tags/Linux/"/>
    
    <category term="MAC 地址伪装" scheme="https://www.coder17.com/tags/MAC-%E5%9C%B0%E5%9D%80%E4%BC%AA%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>Portainer 启动/升级</title>
    <link href="https://www.coder17.com/posts/protainer-launch-update/"/>
    <id>https://www.coder17.com/posts/protainer-launch-update/</id>
    <published>2020-03-26T08:41:00.000Z</published>
    <updated>2020-03-26T08:41:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Launch"><a href="#Launch" class="headerlink" title="Launch"></a>Launch</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker volume create portainer_data</span><br><span class="line">docker run -d -p 127.0.0.1:9000:9000 -p 8000:8000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data --restart unless-stopped --name portainer portainer/portainer</span><br></pre></td></tr></table></figure><p>From <a href="https://portainer.io/install.html">https://portainer.io/install.html</a> </p><h2 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h2><ul><li><p>在 Web 界面执行 Duplicate/Edit</p></li><li><p>直接确认后，会自动拉取新镜像并停止旧 Container，但不能自动拉起新 Container</p></li><li><p>SSH 登录，手动删除旧 Container，再使用上述第二条命令重新拉起即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker rm portainer</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Launch&quot;&gt;&lt;a href=&quot;#Launch&quot; class=&quot;headerlink&quot; title=&quot;Launch&quot;&gt;&lt;/a&gt;Launch&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutt</summary>
      
    
    
    
    <category term="Services" scheme="https://www.coder17.com/categories/Services/"/>
    
    
    <category term="Portainer" scheme="https://www.coder17.com/tags/Portainer/"/>
    
  </entry>
  
  <entry>
    <title>QNAP 硬盘不休眠解决</title>
    <link href="https://www.coder17.com/posts/qnap-hdd-wont-sleep/"/>
    <id>https://www.coder17.com/posts/qnap-hdd-wont-sleep/</id>
    <published>2020-03-18T23:33:00.000Z</published>
    <updated>2020-03-18T23:33:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0-系统-raid-结构"><a href="#0-系统-raid-结构" class="headerlink" title="0. 系统 raid 结构"></a>0. 系统 raid 结构</h2><p>使用 <code>cat /proc/mdstat</code> 可以查看所有 raid 卷。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Personalities</span> :<span class="meta"> [linear] [raid0] [raid1] [raid10] [raid6] [raid5] [raid4] [multipath]</span></span><br><span class="line"><span class="attribute">md3</span> : active raid<span class="number">1</span> sdc<span class="number">3</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="attribute">3897063616</span> blocks super <span class="number">1</span>.<span class="number">0</span><span class="meta"> [1/1] [U]</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">md2</span> : active raid<span class="number">1</span> sda<span class="number">3</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="attribute">7804071616</span> blocks super <span class="number">1</span>.<span class="number">0</span><span class="meta"> [1/1] [U]</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">md1</span> : active raid<span class="number">1</span> sdb<span class="number">3</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="attribute">392120832</span> blocks super <span class="number">1</span>.<span class="number">0</span><span class="meta"> [1/1] [U]</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">md322</span> : active raid<span class="number">1</span> sda<span class="number">5</span>[<span class="number">1</span>] sdc<span class="number">5</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="attribute">7235136</span> blocks super <span class="number">1</span>.<span class="number">0</span><span class="meta"> [2/2] [UU]</span></span><br><span class="line">      <span class="attribute">bitmap</span>: <span class="number">0</span>/<span class="number">1</span> pages<span class="meta"> [0KB], 65536KB chunk</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">md256 : active raid1 sda2[1] sdc2[0]</span></span><br><span class="line">      <span class="attribute">530112</span> blocks super <span class="number">1</span>.<span class="number">0</span><span class="meta"> [2/2] [UU]</span></span><br><span class="line">      <span class="attribute">bitmap</span>: <span class="number">0</span>/<span class="number">1</span> pages<span class="meta"> [0KB], 65536KB chunk</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">md321 : active raid1 sdb5[0]</span></span><br><span class="line">      <span class="attribute">8283712</span> blocks super <span class="number">1</span>.<span class="number">0</span><span class="meta"> [2/1] [U_]</span></span><br><span class="line">      <span class="attribute">bitmap</span>: <span class="number">0</span>/<span class="number">1</span> pages<span class="meta"> [0KB], 65536KB chunk</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">md13 : active raid1 sda4[0] sdc4[33] sdb4[32]</span></span><br><span class="line">      <span class="attribute">458880</span> blocks super <span class="number">1</span>.<span class="number">0</span><span class="meta"> [32/3] [UUU_____________________________]</span></span><br><span class="line">      <span class="attribute">bitmap</span>: <span class="number">1</span>/<span class="number">1</span> pages<span class="meta"> [4KB], 65536KB chunk</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">md9 : active raid1 sda1[0] sdc1[33] sdb1[32]</span></span><br><span class="line">      <span class="attribute">530048</span> blocks super <span class="number">1</span>.<span class="number">0</span><span class="meta"> [32/3] [UUU_____________________________]</span></span><br><span class="line">      <span class="attribute">bitmap</span>: <span class="number">1</span>/<span class="number">1</span> pages<span class="meta"> [4KB], 65536KB chunk</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">unused devices: &lt;none&gt;</span></span><br></pre></td></tr></table></figure><p>注意到 md9 md13 md322 md256 均是横跨了机械硬盘的 raid 卷。搜索后得知 md9 和 md13 是系统自动创建的跨所有硬盘的 raid1 数据卷，存储系统配置和目录等。md322 和 md256 是系统 swap 分区。</p><h2 id="1-系统分区-raid-反复读取"><a href="#1-系统分区-raid-反复读取" class="headerlink" title="1. 系统分区 raid 反复读取"></a>1. 系统分区 raid 反复读取</h2><p>使用 <a href="https://drive.google.com/file/d/0B8u8qWRYVhv0S1ozWFRjazFEX1E/view">blkdevMonitor.sh</a> 脚本查看硬盘读写，可以看到大量 md9 相关读取。因此首先处理 md9 和 md13。</p><p>使用 <code>parted /dev/sdb print</code> 命令查看各硬盘，通过容量判断 sdb 是 SSD，sda 和 sdc 是两块机械硬盘。因此将 SSD 以外的硬盘从阵列中踢出。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Disconnecting md9&quot;</span></span><br><span class="line">mdadm /dev/md9 --fail /dev/sda1</span><br><span class="line">mdadm /dev/md9 --fail /dev/sdc1</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Disconnecting md13&quot;</span></span><br><span class="line">mdadm /dev/md13 --fail /dev/sda4</span><br><span class="line">mdadm /dev/md13 --fail /dev/sdc4</span><br></pre></td></tr></table></figure><p>使用 <code>mdadm -D /dev/md9</code> 验证移除是否成功</p><p>然后使用 <code>hdparm -y /dev/sda</code> 立即休眠硬盘，并使用 <code>hdparm -C /dev/sda</code>查看硬盘状态，<code>active/idle</code> 或者 <code>standby</code></p><p>但断开连接时万一系统盘损坏，则系统数据会丢失，因此每天同步一次。使用下列脚本恢复连接。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Re-adding md9&quot;</span></span><br><span class="line">mdadm /dev/md9 --re-add /dev/sda1</span><br><span class="line">mdadm /dev/md9 --re-add /dev/sdc1</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Re-adding md13&quot;</span></span><br><span class="line">mdadm /dev/md13 --re-add /dev/sda4</span><br><span class="line">mdadm /dev/md13 --re-add /dev/sdc4</span><br></pre></td></tr></table></figure><p>保存上述两个脚本后（记得添加 x 权限），使用 crontab 每天运行一次，加回去15分钟后断开连接，应足够其完成同步。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">echo</span> 15 0 \* \* \* /share/homes/Tojo/rebuild_internal_raid.sh &gt;&gt; /etc/config/crontab</span><br><span class="line">sudo <span class="built_in">echo</span> 30 0 \* \* \* /share/homes/Tojo/disconnect_internal_raid.sh &gt;&gt; /etc/config/crontab</span><br><span class="line">sudo crontab /etc/config/crontab &amp;&amp; sudo /etc/init.d/crond.sh restart</span><br></pre></td></tr></table></figure><p>并修改启动脚本使其自动生效。</p><h2 id="2-swap-分区"><a href="#2-swap-分区" class="headerlink" title="2. swap 分区"></a>2. swap 分区</h2><p>使用 <code>cat /proc/swaps</code> 查看系统 swap 分区，发现很诡异地两个 swap 都建立在机械硬盘上。</p><p>但目前看起来不是很影响休眠，就先不管他了。</p><p>参考：</p><p><a href="https://forum.qnap.com/viewtopic.php?f=55&t=130788">Advanced guide to how I completely silenced my TS-453A - QNAP NAS Community Forum</a></p><p><a href="https://forum.qnap.com/viewtopic.php?t=114286">md clarification please_ - QNAP NAS Community Forum</a></p><p><a href="https://wiki.qnap.com/wiki/Find_out_which_process_prevents_the_hard_drives_from_spindown">Find out which process prevents the hard drives from spindown - QNAPedia</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;0-系统-raid-结构&quot;&gt;&lt;a href=&quot;#0-系统-raid-结构&quot; class=&quot;headerlink&quot; title=&quot;0. 系统 raid 结构&quot;&gt;&lt;/a&gt;0. 系统 raid 结构&lt;/h2&gt;&lt;p&gt;使用 &lt;code&gt;cat /proc/mdstat&lt;/c</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="QNAP" scheme="https://www.coder17.com/tags/QNAP/"/>
    
    <category term="硬盘" scheme="https://www.coder17.com/tags/%E7%A1%AC%E7%9B%98/"/>
    
    <category term="休眠" scheme="https://www.coder17.com/tags/%E4%BC%91%E7%9C%A0/"/>
    
  </entry>
  
  <entry>
    <title>QNAP 添加定时任务</title>
    <link href="https://www.coder17.com/posts/qnap-crontab/"/>
    <id>https://www.coder17.com/posts/qnap-crontab/</id>
    <published>2020-03-18T23:31:00.000Z</published>
    <updated>2020-03-18T23:31:00.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/config/crontab</span><br><span class="line">sudo crontab -l</span><br><span class="line">crontab /etc/config/crontab &amp;&amp; /etc/init.d/crond.sh restart</span><br></pre></td></tr></table></figure><p>记得把要运行的命令属性 +x</p><p>参考：</p><p><a href="https://wiki.qnap.com/wiki/Add_items_to_crontab">Add items to crontab</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="QNAP" scheme="https://www.coder17.com/tags/QNAP/"/>
    
    <category term="crontab" scheme="https://www.coder17.com/tags/crontab/"/>
    
  </entry>
  
  <entry>
    <title>QNAP 修改 sudoers</title>
    <link href="https://www.coder17.com/posts/qnap-mod-sudoers/"/>
    <id>https://www.coder17.com/posts/qnap-mod-sudoers/</id>
    <published>2020-03-15T19:50:00.000Z</published>
    <updated>2020-03-15T19:50:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>威联通 NAS 默认 sudoers 仅包括内置 admin 账户，修改时需要编辑 <code>/usr/etc/sudoers</code> 文件。</p><p>但 <code>/usr/etc</code> 目录中的编辑在重启后均会复原。因此需要在<code>系统设置-&gt;硬件</code>中打开允许 <code>autorun.sh</code> 运行选项，并且编辑该文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount $(/sbin/hal_app --get_boot_pd port_id=0)6 /tmp/config</span><br><span class="line">vim /tmp/config/autorun.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">mkdir -p /usr/etc/sudoers.d</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Tojo ALL=(ALL) ALL&quot;</span> &gt; /usr/etc/sudoers.d/Tojo</span><br></pre></td></tr></table></figure><p>如此即可在重启后自动修改 sudoers。如果直接向 <code>/usr/etc/sudoers</code> 末尾写入配置的话，由于该配置文件最后一行为 include 命令，因此会导致在此之后写入的配置无法生效。因此选择向其加载的配置目录中写入新文件。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;威联通 NAS 默认 sudoers 仅包括内置 admin 账户，修改时需要编辑 &lt;code&gt;/usr/etc/sudoers&lt;/code&gt; 文件。&lt;/p&gt;
&lt;p&gt;但 &lt;code&gt;/usr/etc&lt;/code&gt; 目录中的编辑在重启后均会复原。因此需要在&lt;code&gt;系统设置</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="QNAP" scheme="https://www.coder17.com/tags/QNAP/"/>
    
    <category term="sudoers" scheme="https://www.coder17.com/tags/sudoers/"/>
    
  </entry>
  
  <entry>
    <title>QNAP 添加启动项</title>
    <link href="https://www.coder17.com/posts/qnap-startup/"/>
    <id>https://www.coder17.com/posts/qnap-startup/</id>
    <published>2020-03-12T18:04:00.000Z</published>
    <updated>2020-03-12T18:04:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>在<code>系统设置-&gt;硬件</code>中打开允许 <code>autorun.sh</code> 运行选项，并且编辑该文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount $(/sbin/hal_app --get_boot_pd port_id=0)6 /tmp/config</span><br><span class="line">or sudo mount $(sudo /sbin/hal_app --get_boot_pd port_id=0)6 /tmp/config</span><br><span class="line">vim /tmp/config/autorun.sh</span><br></pre></td></tr></table></figure><p>必须添加 shebang，否则会报错。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>参考：</p><p><a href="https://wiki.qnap.com/wiki/Running_Your_Own_Application_at_Startup">Running Your Own Application at Startup</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在&lt;code&gt;系统设置-&amp;gt;硬件&lt;/code&gt;中打开允许 &lt;code&gt;autorun.sh&lt;/code&gt; 运行选项，并且编辑该文件。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="QNAP" scheme="https://www.coder17.com/tags/QNAP/"/>
    
    <category term="启动项" scheme="https://www.coder17.com/tags/%E5%90%AF%E5%8A%A8%E9%A1%B9/"/>
    
    <category term="autorun" scheme="https://www.coder17.com/tags/autorun/"/>
    
  </entry>
  
  <entry>
    <title>华硕路由添加 DDNS 服务</title>
    <link href="https://www.coder17.com/posts/asus-ddns/"/>
    <id>https://www.coder17.com/posts/asus-ddns/</id>
    <published>2020-03-04T17:05:00.000Z</published>
    <updated>2020-03-04T17:05:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>以 dockdns 为例，必须安装 Merlin 固件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /jffs/scripts/ddns-start</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># register a subdomain at https://www.duckdns.org/ to get your token</span></span><br><span class="line">SUBDOMAIN=<span class="string">&quot;your_subdomain&quot;</span></span><br><span class="line">TOKEN=<span class="string">&quot;your-token&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># no modification below needed</span></span><br><span class="line">curl --silent <span class="string">&quot;https://www.duckdns.org/update?domains=<span class="variable">$SUBDOMAIN</span>&amp;token=<span class="variable">$TOKEN</span>&amp;ip=<span class="variable">$1</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    /sbin/ddns_custom_updated 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    /sbin/ddns_custom_updated 0</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+rx /jffs/scripts/*</span><br></pre></td></tr></table></figure><p>并在 web 设置中 <code>Administration -&gt; System</code> 启用用户脚本，在 <code>WAN -&gt; DDNS -&gt; DDNS Service</code> 中设置为<code>custom</code> 即可。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;以 dockdns 为例，必须安装 Merlin 固件。&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;</summary>
      
    
    
    
    <category term="Hacking" scheme="https://www.coder17.com/categories/Hacking/"/>
    
    
    <category term="华硕" scheme="https://www.coder17.com/tags/%E5%8D%8E%E7%A1%95/"/>
    
    <category term="路由器" scheme="https://www.coder17.com/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
    <category term="Merlin" scheme="https://www.coder17.com/tags/Merlin/"/>
    
    <category term="DDNS" scheme="https://www.coder17.com/tags/DDNS/"/>
    
  </entry>
  
  <entry>
    <title>搭建 Shadowsocks 客户端服务端并加为服务</title>
    <link href="https://www.coder17.com/posts/shadowsocks-server/"/>
    <id>https://www.coder17.com/posts/shadowsocks-server/</id>
    <published>2019-12-27T13:22:00.000Z</published>
    <updated>2019-12-27T13:22:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://gist.github.com/SykieChen/0996b1d1644e2a9d2f7b5b78a71caf2e">https://gist.github.com/SykieChen/0996b1d1644e2a9d2f7b5b78a71caf2e</a></p><h2 id="1-install-and-config"><a href="#1-install-and-config" class="headerlink" title="1. install and config"></a>1. install and config</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python-pip</span><br><span class="line">sudo apt install shadowsocks</span><br><span class="line">or</span><br><span class="line">sudo pip install git+https://github.com/shadowsocks/shadowsocks.git@master</span><br></pre></td></tr></table></figure><h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h2><h3 id="2-1-客户端"><a href="#2-1-客户端" class="headerlink" title="2.1 客户端"></a>2.1 客户端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/shadowsocks.json</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>: <span class="string">&quot;27.102.111.111&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>: <span class="number">1080</span>,</span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span>: <span class="number">12345</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;passsss&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;aes-256-cfb&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-服务端"><a href="#2-2-服务端" class="headerlink" title="2.2 服务端"></a>2.2 服务端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/ssserver.json</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>: <span class="number">1080</span>,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;aes-256-cfb&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;port_password&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;3389&quot;</span>: <span class="string">&quot;passsss&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;2003&quot;</span>: <span class="string">&quot;passsss&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>:<span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span>:<span class="number">3389</span>,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>:<span class="string">&quot;passsss&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>:<span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>:<span class="string">&quot;aes-256-cfb&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fast_open&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-add-as-service"><a href="#3-add-as-service" class="headerlink" title="3. add as service"></a>3. add as service</h2><h3 id="3-1-客户端"><a href="#3-1-客户端" class="headerlink" title="3.1 客户端"></a>3.1 客户端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/shadowsocks.service</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Shadowsocks Client Service</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">User</span>=tojo</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/sslocal -c /etc/shadowsocks.json</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> /etc/systemd/system/shadowsocks.service</span><br><span class="line">sudo systemctl start shadowsocks.service</span><br><span class="line">service shadowsocks status</span><br></pre></td></tr></table></figure><h3 id="3-2-服务端"><a href="#3-2-服务端" class="headerlink" title="3.2 服务端"></a>3.2 服务端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/ssserver.service</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Shadowsocks Server Service</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">User</span>=tojo</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/ssserver -c /etc/ssserver.json</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> /etc/systemd/system/ssserver.service</span><br><span class="line">sudo systemctl start ssserver.service</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://gist.github.com/SykieChen/0996b1d1644e2a9d2f7b5b78a71caf2e&quot;&gt;https://gist.github.com/SykieChen/0996b1d1644e2a9d2f7b5b78a7</summary>
      
    
    
    
    <category term="Services" scheme="https://www.coder17.com/categories/Services/"/>
    
    
    <category term="Shadowsocks" scheme="https://www.coder17.com/tags/Shadowsocks/"/>
    
    <category term="服务端" scheme="https://www.coder17.com/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>Nginx 禁止未授权 URL 访问（HTTP 444）</title>
    <link href="https://www.coder17.com/posts/nginx-ban-url/"/>
    <id>https://www.coder17.com/posts/nginx-ban-url/</id>
    <published>2019-12-20T18:47:00.000Z</published>
    <updated>2019-12-20T18:47:00.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line">    listen 443 default_server ssl;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;coder17.com-0001&#x2F;fullchain.pem;</span><br><span class="line">    ssl_certificate_key &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;coder17.com-0001&#x2F;privkey.pem;</span><br><span class="line">    server_name _;</span><br><span class="line">    return 444;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中证书可以随便指定</p>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class</summary>
      
    
    
    
    <category term="Services" scheme="https://www.coder17.com/categories/Services/"/>
    
    
    <category term="Nginx" scheme="https://www.coder17.com/tags/Nginx/"/>
    
    <category term="过滤" scheme="https://www.coder17.com/tags/%E8%BF%87%E6%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Certbot cloudflare 泛域名证书配置</title>
    <link href="https://www.coder17.com/posts/certbot-cloudflare-wildcard/"/>
    <id>https://www.coder17.com/posts/certbot-cloudflare-wildcard/</id>
    <published>2019-12-15T19:30:00.000Z</published>
    <updated>2019-12-15T19:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install software-properties-common</span><br><span class="line">sudo add-apt-repository universe</span><br><span class="line">sudo add-apt-repository ppa:certbot/certbot</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y certbot python3-certbot-dns-cloudflare</span><br></pre></td></tr></table></figure><h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2.  配置"></a>2.  配置</h2><blockquote><p>  Use of this plugin requires a configuration file containing Cloudflare API credentials, obtained from your Cloudflare account page.</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/letsencrypt/cloudflare.ini</span><br></pre></td></tr></table></figure><p>  Example credentials file:</p>  <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Cloudflare API credentials used by Certbot</span></span><br><span class="line"><span class="attr">dns_cloudflare_email</span> = cloudflare@example.com</span><br><span class="line"><span class="attr">dns_cloudflare_api_key</span> = <span class="number">0123456789</span>abcdef0123456789abcdef01234567</span><br></pre></td></tr></table></figure><p>  The path to this file can be provided interactively or using the –dns-cloudflare-credentials command-line argument. Certbot records the path to this file for use during renewal, but does not store the file’s contents.</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 600 /etc/letsencrypt/cloudflare.ini</span><br></pre></td></tr></table></figure></blockquote><h2 id="3-获取"><a href="#3-获取" class="headerlink" title="3. 获取"></a>3. 获取</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot -a dns-cloudflare --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini -i nginx -d <span class="string">&quot;*.coder17.com&quot;</span> -d coder17.com</span><br></pre></td></tr></table></figure><p>注意不能完全信任其对 nginx 的修改</p><p>如果不需要自动修改 nginx 则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot certonly -a dns-cloudflare --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini -d <span class="string">&quot;home.coder17.com&quot;</span> -d <span class="string">&quot;frph.coder17.com&quot;</span> -d <span class="string">&quot;*.frph.coder17.com&quot;</span> -d <span class="string">&quot;*.home.coder17.com&quot;</span></span><br></pre></td></tr></table></figure><h2 id="4-更新测试"><a href="#4-更新测试" class="headerlink" title="4. 更新测试"></a>4. 更新测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew --dry-run</span><br></pre></td></tr></table></figure><h2 id="5-部署自动更新"><a href="#5-部署自动更新" class="headerlink" title="5. 部署自动更新"></a>5. 部署自动更新</h2><p>默认情况下会自动添加自动更新，每天两次。<br>使用 <code>sudo systemctl list-timers</code> 查看，配置文件位于 <code>/etc/systemctl/system/timers.target.wants/certbot.timer</code></p><p>如果运行有问题，使用下面命令创建 crontab 任务，每两个月一次。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e</span><br><span class="line"></span><br><span class="line">0 0 1 */2 * /usr/bin/certbot renew &gt;&gt; <span class="string">&quot;/var/log/certbot_<span class="subst">$(date +<span class="string">&quot;\%Y-\%m-\%d&quot;</span>)</span>.log&quot;</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">sudo service cron restart</span><br></pre></td></tr></table></figure><h2 id="6-转换证书格式"><a href="#6-转换证书格式" class="headerlink" title="6. 转换证书格式"></a>6. 转换证书格式</h2><p>默认申请的是 pem 格式证书，位于 <code>/etc/letsencrypt/live</code> 中，需要转换为 Windows 使用的 pfx 格式时，使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="built_in">export</span> -out certificate.pfx -inkey privkey.pem -<span class="keyword">in</span> cert.pem -certfile chain.pem -passout pass:</span><br></pre></td></tr></table></figure><h2 id="7-复制"><a href="#7-复制" class="headerlink" title="7. 复制"></a>7. 复制</h2><p>因为 live 目录中为软连接，复制时需要使用 <code>-L</code> 参数，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -Lr /etc/letsencrypt/live /mnt/hgfs/certs</span><br></pre></td></tr></table></figure><p>Refer: <a href="https://certbot-dns-cloudflare.readthedocs.io/en/stable/">https://certbot-dns-cloudflare.readthedocs.io/en/stable/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-安装&quot;&gt;&lt;a href=&quot;#1-安装&quot; class=&quot;headerlink&quot; title=&quot;1. 安装&quot;&gt;&lt;/a&gt;1. 安装&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;p</summary>
      
    
    
    
    <category term="Services" scheme="https://www.coder17.com/categories/Services/"/>
    
    
    <category term="Certbot" scheme="https://www.coder17.com/tags/Certbot/"/>
    
    <category term="cloudflare" scheme="https://www.coder17.com/tags/cloudflare/"/>
    
    <category term="泛域名证书" scheme="https://www.coder17.com/tags/%E6%B3%9B%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6/"/>
    
  </entry>
  
</feed>
